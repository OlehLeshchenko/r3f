import{bc as z,T as d,bd as A,be as B,bf as I,O as k,d as N,Y as E,H as O}from"./index-DAa9yKAB.js";class b{constructor(s,t,u){this.kind=s??"g",this.childs=[],this.x=0,this.y=0,this.font_size=t?.font_size??u,this.stroke_width=t?.stroke_width??5,t?.childs.push(this)}append(s){if(s==="svg:g")return new b("g",this);if(s==="svg:text")return new b("text",this);if(s==="svg:path")return new b("path",this);console.warn("missing handle for svg",s)}style(s,t){return s==="stroke-width"&&t&&(this.stroke_width=Number.parseInt(t)),this}property(s,t){return t===void 0?this[s]:(this[s]=t,this)}attr(s,t){const u=()=>{if(!t)return"";const i=t[0];return t=t.slice(1),i},e=i=>{let n=0;for(;t[n]>="0"&&t[n]<="9"||t[n]==="-";)n++;const x=Number.parseInt(t.slice(0,n));return t=t.slice(n),i&&u(),x};if(s==="font-size"&&t)this.font_size=Number.parseInt(t);else if(s==="transform"&&E(t)&&t.indexOf("translate")===0){const i=t.slice(t.indexOf("(")+1,t.lastIndexOf(")")).split(",");this.x+=i[0]?Number.parseInt(i[0])*.01:0,this.y-=i[1]?Number.parseInt(i[1])*.01:0}else if(s==="x"&&this.kind==="text")this.x+=Number.parseInt(t)*.01;else if(s==="y"&&this.kind==="text")this.y-=Number.parseInt(t)*.01;else if(s==="fill"&&this.kind==="text")this.fill=t;else if(s==="d"&&this.kind==="path"&&t!=="M0,0"){if(u()!=="M")return console.error("Not starts with M");let i=e(!0),n=e(),x;const g=[],r=(a,l)=>{const c=Math.atan2(l-n,a-i),h=.5*this.stroke_width*Math.sin(c),f=-.5*this.stroke_width*Math.cos(c);g.push(i-h,n-f,0,a-h,l-f,0,a+h,l+f,0,i-h,n-f,0,a+h,l+f,0,i+h,n+f,0),g.push(i-h,n-f,0,a+h,l+f,0,a-h,l-f,0,i-h,n-f,0,i+h,n+f,0,a+h,l+f,0),i=a,n=l};for(;x=u();)switch(x){case"L":r(e(!0),e());continue;case"l":r(i+e(!0),n+e());continue;case"H":r(e(),n);continue;case"h":r(i+e(),n);continue;case"V":r(i,e());continue;case"v":r(i,n+e());continue;case"a":{const a=e(!0),l=e(!0),c=e(!0)/180*Math.PI,h=e(!0);e(!0);const f=i+e(!0),o=n+e(),w=i+a*Math.cos(c),y=n+l*Math.sin(c);let p=Math.atan2(y-o,w-f);h&&p<c?p+=2*Math.PI:!h&&p>c&&(p-=2*Math.PI);for(let M=0;M<10;++M){const _=c+(p-c)/10*(M+1);r(w-a*Math.cos(_),y-l*Math.sin(_))}continue}default:console.log("not supported path operator",x)}if(g.length){const a=new Float32Array(g);this.geom=new d.BufferGeometry,this.geom.setAttribute("position",new d.BufferAttribute(a,3)),this.geom.scale(.01,-.01,.01),this.geom.computeVertexNormals()}}return this}text(s){this.kind==="text"&&(this._text=s)}collect(s,t,u){if(this._text){t.size=Math.round(.01*this.font_size);const e=new d.TextGeometry(this._text,t);u&&(e.scale(1,.9,1),e.translate(0,5e-4*this.font_size,0)),e.translate(this.x,this.y,0),e._fill=this.fill,s.push(e)}this.geom&&(this.geom.translate(this.x,this.y,0),this.geom._fill=this.fill,s.push(this.geom)),this.childs.forEach(e=>{e.x+=this.x,e.y+=this.y,e.collect(s,t,u)})}}function T(m,s,t,u,e=!0){const i={font:z(),size:t,height:0,curveSegments:5},n=t*100,x=new b("g",null,n),g={font_size:n,text:s,fast:!0,font:{size:n,isMonospace:()=>!1,aver_width:.9}},r=[];if(d.REVISION>162?i.depth=0:i.height=0,A(s)||(B(m,x,g),x.collect(r,i,u)),!r.length){i.size=t;const o=new d.TextGeometry(I(s),i);return u?[o]:o}if(u)return r;if(r.length===1)return r[0];let a=0;r.forEach(o=>{a+=o.getAttribute("position").array.length});const l=new Float32Array(a),c=new Float32Array(a);let h=0;r.forEach(o=>{const w=o.getAttribute("position").array,y=o.getAttribute("normal").array;for(let p=0;p<w.length;++p,++h)l[h]=w[p],c[h]=y[p]});const f=new d.BufferGeometry;return f.setAttribute("position",new d.BufferAttribute(l,3)),f.setAttribute("normal",new d.BufferAttribute(c,3)),f}function L(m,s,t,u){t||(t=new k(null,m,s));const e=t.createAttText({attr:m}),i=e.align%10,n=(e.align-i)/10,x=e.size>1?e.size:2*e.size*(u?.size_z3d||100),g=T(t,m.fTitle,x||10,!0,u||m._typename===N),r=new d.Box3().makeEmpty();g.forEach(o=>{o.computeBoundingBox(),r.expandByPoint(o.boundingBox.max),r.expandByPoint(o.boundingBox.min)});let a=0,l=0;n===2?a=.5*(r.max.x+r.min.x):n===3&&(a=r.max.x),i===2?l=.5*(r.max.y+r.min.y):i===3&&(l=r.max.y);const c=new d.Object3D,h=[],f=o=>(o||(o="black"),h[o]||(h[o]=new d.MeshBasicMaterial(O(o,{vertexColors:!1}))),h[o]);return g.forEach(o=>{o.translate(-a,-l,0),c.add(new d.Mesh(o,f(o._fill||e.color)))}),g.length===1?c.children[0]:c}export{L as build3dlatex,T as createLatexGeometry};
