import{O as _,B as u,j as E,p as x,q as P,W as O,o as A,X as F,t as G,Y as C}from"./index-DAa9yKAB.js";import{clTGraphAsymmErrors as S,TGraphPainter as L}from"./TGraphPainter-DECA4bpc.js";import{TF1Painter as M}from"./TF1Painter-CSSx4PF-.js";import{TH1Painter as N}from"./TH1Painter-BmkwKNTG.js";import{TH2Painter as H}from"./TH2Painter-yQJYXbd3.js";import"./THistPainter-DJAmNO-k.js";import"./TPavePainter-DMWA3hUD.js";import"./TH1Painter-C7yoCsum.js";import"./func-CztLwFD8.js";import"./hist3d-BC5Tno_J.js";import"./latex3d-BISPawP1.js";import"./TH2Painter-Ba0oelVz.js";const h=u(14),X=u(15),c=u(17),k=u(18),g=(l,t)=>l.fBeta_bin_params.length>t?l.fBeta_bin_params[t].first:l.fBeta_alpha,T=(l,t)=>l.fBeta_bin_params.length>t?l.fBeta_bin_params[t].second:l.fBeta_beta;class w extends _{getEfficiency(t,i){const r=(e,f)=>e<=0||f<=0?0:e/(e+f),a=(e,f)=>{if(e<=0||f<=0)return 0;if(e<=1||f<=1){if(e<f)return 0;if(e>f)return 1;if(e===f)return .5}return(e-1)/(e+f-2)},n=t.fTotalHistogram.fArray[i],s=t.fPassedHistogram.fArray[i];if(t.TestBit(h)){const e=t.TestBit(c)?g(t,i):t.fBeta_alpha,f=t.TestBit(c)?T(t,i):t.fBeta_beta;let o,m;if(t.TestBit(k)){const d=n,p=t.fTotalHistogram.fSumw2?t.fTotalHistogram.fSumw2[i]:Math.abs(n),B=s;if(p<=0)return B/d;const y=d/p;o=B*y+e,m=(d-B)*y+f}else o=s+e,m=n-s+f;return t.TestBit(X)?a(o,m):r(o,m)}return n?s/n:0}getEfficiencyErrorLow(t,i,r){const a=t.fTotalHistogram.fArray[i],n=t.fPassedHistogram.fArray[i];let s=0,e=0;return t.TestBit(h)&&(s=t.TestBit(c)?g(t,i):t.fBeta_alpha,e=t.TestBit(c)?T(t,i):t.fBeta_beta),r-this.fBoundary(a,n,t.fConfLevel,!1,s,e)}getEfficiencyErrorUp(t,i,r){const a=t.fTotalHistogram.fArray[i],n=t.fPassedHistogram.fArray[i];let s=0,e=0;return t.TestBit(h)&&(s=t.TestBit(c)?g(t,i):t.fBeta_alpha,e=t.TestBit(c)?T(t,i):t.fBeta_beta),this.fBoundary(a,n,t.fConfLevel,!0,s,e)-r}copyAttributes(t,i){["fLineColor","fLineStyle","fLineWidth","fFillColor","fFillStyle","fMarkerColor","fMarkerStyle","fMarkerSize"].forEach(r=>{t[r]=i[r]})}createGraph(){const t=E(S);return t.fName="eff_graph",t}createHisto(t){const i=t.fTotalHistogram.fXaxis.fNbins,r=t.fTotalHistogram.fYaxis.fNbins,a=x(G,i,r);return Object.assign(a.fXaxis,t.fTotalHistogram.fXaxis),Object.assign(a.fYaxis,t.fTotalHistogram.fYaxis),a.fName="eff_histo",a}fillGraph(t,i){const r=this.getObject(),a=r.fTotalHistogram.fXaxis,n=a.fNbins,s=i.indexOf("e0")>=0;for(let e=0,f=0;e<n;++e){if(!s&&r.fTotalHistogram.getBinContent(e+1)===0)continue;const o=this.getEfficiency(r,e+1);t.fX[f]=a.GetBinCenter(e+1),t.fY[f]=o,t.fEXlow[f]=a.GetBinCenter(e+1)-a.GetBinLowEdge(e+1),t.fEXhigh[f]=a.GetBinLowEdge(e+2)-a.GetBinCenter(e+1),t.fEYlow[f]=this.getEfficiencyErrorLow(r,e+1,o),t.fEYhigh[f]=this.getEfficiencyErrorUp(r,e+1,o),t.fNpoints=++f}t.fTitle=r.fTitle,this.copyAttributes(t,r)}fillHisto(t){const i=this.getObject(),r=t.fXaxis.fNbins,a=t.fYaxis.fNbins;for(let n=0;n<r+2;++n)for(let s=0;s<a+2;++s){const e=t.getBin(n,s);t.fArray[e]=this.getEfficiency(i,e)}t.fTitle=i.fTitle,t.fBits|=P,this.copyAttributes(t,i)}drawFunction(t){const i=this.getObject();return!i?.fFunctions||t>=i.fFunctions.arr.length?this:M.draw(this.getPadPainter(),i.fFunctions.arr[t],i.fFunctions.opt[t]).then(r=>(r?.setSecondaryId(this,`func_${t}`),this.drawFunction(t+1)))}fillContextMenuItems(t){t.addRedrawMenu(this)}async redrawWith(t,i){i||this.getPadPainter()?.removePrimitive(this,!0),(!t||!C(t))&&(t=""),t=t.toLowerCase();let r,a=!1;const n=this.getObject(),s=this.getDrawDom();if(t[0]==="b")a=!0,r=(this.ndim===1?N:H).draw(s,n.fTotalHistogram,t.slice(1));else if(this.ndim===1){t||(t="ap"),t.indexOf("same")<0&&t.indexOf("a")<0&&(t+="a"),t.indexOf("p")<0&&(t+="p");const e=this.createGraph(n);this.fillGraph(e,t),r=L.draw(s,e,t)}else{t||(t="col");const e=this.createHisto(n);this.fillHisto(e,t),r=H.draw(s,e,t)}return r.then(e=>(e?.setSecondaryId(this,"eff"),this.addToPadPrimitives(),a?this:this.drawFunction(0)))}static async draw(t,i,r){if(!i||!i.fTotalHistogram)return null;const a=new w(t,i);if(i.fTotalHistogram._typename.indexOf(O)===0)a.ndim=1;else if(i.fTotalHistogram._typename.indexOf(A)===0)a.ndim=2;else return null;return a.fBoundary=F(i.fStatisticOption,i.TestBit(h)),a.redrawWith(r,!0)}}export{w as TEfficiencyPainter};
