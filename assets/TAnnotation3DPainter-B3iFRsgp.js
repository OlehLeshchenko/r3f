import{i as c,m as f,e as x}from"./index-DAa9yKAB.js";import{TTextPainter as u}from"./TTextPainter-DCuWyAiY.js";import{build3dlatex as p}from"./latex3d-BISPawP1.js";function a(i,t){const e=i.position.x-t.position.x,s=i.position.y-t.position.y;return Math.atan2(s,e)+Math.PI/2}class d extends u{async redraw(){const t=this.getFramePainter(),e=this.getObject();if(t?.mode3d&&!this.use_2d){const o=p(e,"",this,t);return o.traverse(h=>h.geometry?.rotateX(Math.PI/2)),o.position.set(t.grx(e.fX),t.gry(e.fY),t.grz(e.fZ)),o.rotation.set(0,0,a(t.camera,o)),t.processRender3D=!0,t.add3DMesh(o,this,!0),t.render3D(100),this}const s=t?.mode3d&&c(t?.convert3DtoPadNDC)?"3d":"2d";let r=e.fX,n=e.fY;if(s==="3d"){const o=t.convert3DtoPadNDC(e.fX,e.fY,e.fZ);r=o.x,n=o.y}return this._redrawText(r,n,s).then(()=>(t.processRender3D=s==="3d",this))}handleRender3D(){const t=this.getObject(),e=this.getFramePainter();if(this.use_2d){const s=e.convert3DtoPadNDC(t.fX,t.fY,t.fZ),r=this.axisToSvg("x",s.x,!0),n=this.axisToSvg("y",s.y,!0);f(this.getG(),r-this.pos_x,n-this.pos_y)}else e.get3DMeshes(this).forEach(s=>s.rotation.set(0,0,a(e.camera,s)))}static async draw(t,e,s){const r=new d(t,e,s);return r.use_2d=s==="2d"||s==="2D",x(r,r.use_2d?!0:"3d").then(()=>r.redraw())}}export{d as TAnnotation3DPainter};
