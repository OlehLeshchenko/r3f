import{L as u,j as _,i as P,Z as y,l as c,_ as H}from"./index-DAa9yKAB.js";import{TGraphPainter as z}from"./TGraphPainter-DECA4bpc.js";import{H as N}from"./THistPainter-DJAmNO-k.js";import{T as G}from"./TH2Painter-Ba0oelVz.js";import"./TH1Painter-C7yoCsum.js";import"./func-CztLwFD8.js";import"./TPavePainter-DMWA3hUD.js";class M extends z{#e;#t;cleanup(){this.clearHistPalette(),this.#t=void 0,super.cleanup()}getGraph(){return this.getObject()?.fGraph}getContour(){return this.#t}isScatter(){return!0}getHistRangeMargin(){return this.getObject()?.fMargin??.1}async drawAxisHisto(){const e=this.isDummyHistogram("x"),i=this.isDummyHistogram("y"),t=this.createHistogram(e,i);return G.draw(this.getDrawDom(),t,this.getOptions().Axis+";IGNORE_PALETTE")}getPalette(){const e=this.getGraph();let i=e?.fFunctions?.arr?.find(t=>t._typename===u);if(!i&&e){i=_(u);const t=this.get_fp();Object.assign(i,{fX1NDC:t.fX2NDC+.005,fX2NDC:t.fX2NDC+.05,fY1NDC:t.fY1NDC,fY2NDC:t.fY2NDC,fInit:1,$can_move:!0}),Object.assign(i.fAxis,{fChopt:"+",fLineColor:1,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextAlign:11,fNdiv:510}),e.fFunctions.AddFirst(i,"")}return i}_updateMembers(e,i){return e.fBits=i.fBits,e.fTitle=i.fTitle,e.fNpoints=i.fNpoints,e.fColor=i.fColor,e.fSize=i.fSize,e.fMargin=i.fMargin,e.fMinMarkerSize=i.fMinMarkerSize,e.fMaxMarkerSize=i.fMaxMarkerSize,super._updateMembers(e.fGraph,i.fGraph)}getZaxis(){return this.getHistogram()?.fZaxis}canZoomInside(e,i,t){if(e!=="z")return super.canZoomInside(e,i,t);const n=this.#t?.getLevels();if(!n)return!1;for(let o=0;o<n.length-1;++o)if(i<=n[o]&&t>=n[o+1])return!0;return!1}getHistPalette(e){let i=e?null:this.#e;if(i)return i;const t=this.getPadPainter();return P(t?.getCustomPalette)&&(i=t.getCustomPalette()),i||(i=y(this.getOptions().Palette,t?.isGrayscale())),this.#e=i,i}clearHistPalette(){this.#e=void 0}async drawGraph(){const e=this.get_fp(),i=this.getMainPainter(),t=this.getObject(),n=this.getHistogram();let o=1,l=0,m;if(!e||!i||!t)return;if(t.fColor){const a=this.getPalette();a&&(a.$main_painter=this),m=this.getHistPalette();let r=t.fColor[0],s=t.fColor[0];for(let f=1;f<t.fColor.length;++f)r=Math.min(r,t.fColor[f]),s=Math.max(s,t.fColor[f]);s<=r?s=r<0?.9*r:r>0?1.1*r:1:r>0&&r<.3*s&&(r=0),this.#t=new N(r,s),this.#t.createNormal(30),this.#t.configIndicies(0,0),e.zmin=r,e.zmax=s,!e.zoomChangedInteractive("z")&&n&&n.fMinimum!==c&&n.fMaximum!==c&&(e.zoom_zmin=n.fMinimum,e.zoom_zmax=n.fMaximum)}if(t.fSize){let a=t.fSize[0],r=t.fSize[0];for(let s=1;s<t.fSize.length;++s)a=Math.min(a,t.fSize[s]),r=Math.max(r,t.fSize[s]);r<=a&&(r=a<0?.9*a:a>0?1.1*a:1),o=(t.fMaxMarkerSize-t.fMinMarkerSize)/(r-a),l=a}const C=this.createG(!e.pad_layer),h=e.getGrFuncs(),d=e.zoom_zmin!==e.zoom_zmax&&t.fColor,g=this._getBins();for(let a=0;a<g.length;++a){if(d&&(t.fColor[a]<e.zoom_zmin||t.fColor[a]>e.zoom_zmax))continue;const r=g[a],s=h.grx(r.x),f=h.gry(r.y),x=t.fSize?t.fMinMarkerSize+o*(t.fSize[a]-l):t.fMarkerSize,S=t.fColor?this.#t.getPaletteColor(m,t.fColor[a]):this.getColor(t.fMarkerColor),p=new H({color:S,size:x,style:t.fMarkerStyle});C.append("svg:path").attr("d",p.create(s,f)).call(p.func)}return this}static async draw(e,i,t){return z._drawGraph(new M(e,i),t)}}export{M as TScatterPainter};
