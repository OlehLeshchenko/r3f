import{O as W,aU as v,i as C,aV as G,aC as K,q as T,B as z,l as g,E as x,S as y,U as M,n as d,j as N,aW as I,K as D,aX as V,a9 as J,a5 as q,L as O,u as $,aY as Q,Y,s as tt,I as U,Z as it,aZ as et,a_ as st,a$ as nt,b0 as rt,e as ft,aG as Z,b1 as at,D as ot,$ as ht}from"./index-DAa9yKAB.js";import{TPavePainter as L,kPosTitle as lt}from"./TPavePainter-DMWA3hUD.js";const b=1,E=2,ct=3,ut=4,mt=5,xt=0,dt=1,j=2,A="only-check";class gt{constructor(){this.reset()}reset(){Object.assign(this,{Axis:0,RevX:!1,RevY:!1,SymlogX:0,SymlogY:0,xticks:null,yticks:null,Bar:!1,BarStyle:0,Curve:!1,Hist:1,Line:!1,Fill:!1,Error:0,ErrorKind:-1,errorX:d.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,AllFunc:!1,Arrow:!1,Box:!1,BoxStyle:0,Text:!1,TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Cjust:!1,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Ortho:d.fOrthoCamera,Spec:!1,Pie:!1,List:!1,Zscale:!1,Zvert:!0,PadPalette:!1,Candle:"",Violin:"",Scaled:null,Circular:0,Poisson:xt,GLBox:0,GLColor:!1,Project:"",ProfileProj:"",Profile2DProj:"",System:b,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:1,Palette:0,BaseLine:!1,ShowEmpty:!1,Optimize:D.OptimizeDraw,Mode3D:!1,x3dscale:1,y3dscale:1,SwapXY:!1,Render3D:Z.Render3D.Default,FrontBox:!0,BackBox:!0,need_fillcol:!1,minimum:g,maximum:g,ymin:0,ymax:0,cutg:null,IgnoreMainScale:!1,IgnorePalette:!1})}isCartesian(){return this.System===b}is3d(){return this.Lego||this.Surf}decodeSumw2(i,s){const t=i.fSumw2?.length??0;let r=!1;for(let n=0;n<t;++n)if(i.fSumw2[n]>0){r=!0;break}(Number.isInteger(this.Error)||s)&&(this.Error=r?1:0),(Number.isInteger(this.Hist)||s)&&(this.Hist=r?0:1),(Number.isInteger(this.Zero)||s)&&(this.Zero=r?0:1)}canHavePalette(){return this.ndim===3?this.BoxStyle===12||this.BoxStyle===13||this.GLBox===12:this.ndim===1?this.Lego===12||this.Lego===14:this.Mode3D?this.Lego===12||this.Lego===14||this.Surf===11||this.Surf===12:this.Color||this.Contour||this.Hist||this.Axis?!0:!this.Scat&&!this.Box&&!this.Arrow&&!this.Proj&&!this.Candle&&!this.Violin&&!this.Text}decode(i,s,t,r,n,a){if(this.orginal=i,this.cutg_name="",Y(i)&&s===2){const c=i.lastIndexOf("["),u=i.lastIndexOf("]");c>=0&&u>c+1&&i.at(c-1)!==":"&&(this.cutg_name=i.slice(c+1,u),i=i.slice(0,c)+i.slice(u+1),this.cutg=r?.findInPrimitives(this.cutg_name,at),this.cutg&&(this.cutg.$redraw_pad=!0))}const e=new ot(i);s===1&&this.decodeSumw2(t,!0),this.ndim=s||1,e.check("USE_PAD_TITLE"),e.check("USE_PAD_PALETTE"),e.check("USE_PAD_STATS"),e.check("IGNORE_PALETTE")&&(this.IgnorePalette=!0),e.check("PAL",!0)&&(this.Palette=e.partAsInt()),e.check("MINIMUM:",!0)?(this.ominimum=!0,this.minimum=parseFloat(e.part)):(this.ominimum=!1,this.minimum=t.fMinimum),e.check("MAXIMUM:",!0)?(this.omaximum=!0,this.maximum=parseFloat(e.part)):(this.omaximum=!1,this.maximum=t.fMaximum),!this.ominimum&&!this.omaximum&&this.minimum===this.maximum&&(this.minimum=this.maximum=g),this.ohmin=e.check("HMIN:",!0),this.hmin=this.ohmin?parseFloat(e.part):void 0,this.ohmax=e.check("HMAX:",!0),this.hmax=this.ohmax?parseFloat(e.part):void 0,this.zoom_min_max=e.check("ZOOM_MIN_MAX"),e.check("HTITLE:",!0)&&(t.fTitle=decodeURIComponent(e.part.toLowerCase())),e.check("XTITLE:",!0)&&(t.fXaxis.fTitle=decodeURIComponent(e.part.toLowerCase())),e.check("YTITLE:",!0)&&(t.fYaxis.fTitle=decodeURIComponent(e.part.toLowerCase())),e.check("ZTITLE:",!0)&&(t.fZaxis.fTitle=decodeURIComponent(e.part.toLowerCase())),e.check("POISSON2")&&(this.Poisson=j),e.check("POISSON")&&(this.Poisson=dt),e.check("SHOWEMPTY")&&(this.ShowEmpty=!0),e.check("NOOPTIMIZE")&&(this.Optimize=0),e.check("OPTIMIZE")&&(this.Optimize=2),e.check("AUTOCOL")&&(this.AutoColor=!0),e.check("AUTOZOOM")&&(this.AutoZoom=!0),e.check("OPTSTAT",!0)&&(this.optstat=e.partAsInt()),e.check("OPTFIT",!0)&&(this.optfit=e.partAsInt()),e.check("XTICKS:","array")&&(this.xticks=e.array),this.ndim>1&&e.check("YTICKS:","array")&&(this.yticks=e.array),(this.optstat||this.optfit)&&t?.SetBit(T,!1),e.check("ALLBINS")&&t&&(t.fXaxis.fFirst=0,t.fXaxis.fLast=t.fXaxis.fNbins+1,t.fXaxis.SetBit(x.kAxisRange),this.ndim>1&&(t.fYaxis.fFirst=0,t.fYaxis.fLast=t.fYaxis.fNbins+1,t.fYaxis.SetBit(x.kAxisRange)),this.ndim>2&&(t.fZaxis.fFirst=0,t.fZaxis.fLast=t.fZaxis.fNbins+1,t.fZaxis.SetBit(x.kAxisRange))),e.check("NOSTAT")&&(this.NoStat=!0),e.check("STAT")&&(this.ForceStat=!0),e.check("NOTOOLTIP")&&a?.setTooltipAllowed(!1),e.check("TOOLTIP")&&a?.setTooltipAllowed(!0),e.check("SYMLOGX",!0)&&(this.SymlogX=e.partAsInt(0,3)),e.check("SYMLOGY",!0)&&(this.SymlogY=e.partAsInt(0,3)),e.check("X3DSC",!0)&&(this.x3dscale=e.partAsInt(0,100)/100),e.check("Y3DSC",!0)&&(this.y3dscale=e.partAsInt(0,100)/100),(e.check("PERSPECTIVE")||e.check("PERSP"))&&(this.Ortho=!1),e.check("ORTHO")&&(this.Ortho=!0);let f=0,o=0,l="";if(e.check("LOG2XY")&&(f=o=2),e.check("LOGXY")&&(f=o=1),e.check("LOG2X")&&(f=2),e.check("LOGX")&&(f=1),e.check("LOG2Y")&&(o=2),e.check("LOGY")&&(o=1),f&&n&&(n.fLogx=f,n.fUxmin=0,n.fUxmax=1,n.fX1=0,n.fX2=1),o&&n&&(n.fLogy=o,n.fUymin=0,n.fUymax=1,n.fY1=0,n.fY2=1),e.check("LOG2Z")&&n&&(n.fLogz=2),e.check("LOGZ")&&n&&(n.fLogz=1),e.check("LOGV")&&n&&(n.fLogv=1),e.check("GRIDXY")&&n&&(n.fGridx=n.fGridy=1),e.check("GRIDX")&&n&&(n.fGridx=1),e.check("GRIDY")&&n&&(n.fGridy=1),e.check("TICKXY")&&n&&(n.fTickx=n.fTicky=1),e.check("TICKX")&&n&&(n.fTickx=1),e.check("TICKY")&&n&&(n.fTicky=1),e.check("TICKZ")&&n&&(n.fTickz=1),e.check("GRAYSCALE")&&r?.setGrayscale(!0),e.check("FILL_","color")&&(this.histoFillColor=e.color,this.histoFillPattern=1001),e.check("FILLPAT_",!0)&&(this.histoFillPattern=e.partAsInt()),e.check("LINE_","color")&&(this.histoLineColor=a.getColor(e.color)),e.check("WIDTH_",!0)&&(this.histoLineWidth=e.partAsInt()),e.check("XAXIS_","color")&&(t.fXaxis.fAxisColor=t.fXaxis.fLabelColor=t.fXaxis.fTitleColor=e.color),e.check("YAXIS_","color")&&(t.fYaxis.fAxisColor=t.fYaxis.fLabelColor=t.fYaxis.fTitleColor=e.color),e.check("X+")&&(this.AxisPos=10,this.second_x=!!a?.getMainPainter()),e.check("Y+")&&(this.AxisPos+=1,this.second_y=!!a?.getMainPainter()),e.check("SAME0")&&(this.Same=this.IgnoreMainScale=!0),e.check("SAMES")&&(this.Same=this.ForceStat=!0),e.check("SAME")&&(this.Same=this.Func=!0),e.check("SPEC")&&(this.Spec=!0),e.check("BASE0")||e.check("MIN0")?this.BaseLine=0:d.fHistMinimumZero&&(this.BaseLine=0),e.check("PIE")&&(this.Pie=!0),e.check("CANDLE",!0)&&(this.Candle=e.part||"1"),e.check("VIOLIN",!0)&&(this.Violin=e.part||"1",delete this.Candle),e.check("NOSCALED")&&(this.Scaled=!1),e.check("SCALED")&&(this.Scaled=!0),e.check("GLBOX",!0)&&(this.GLBox=10+e.partAsInt()),e.check("GLCOL")&&(this.GLColor=!0),e.check("GL"),(e.check("CIRCULAR",!0)||e.check("CIRC",!0))&&(this.Circular=11,e.part.indexOf("0")>=0&&(this.Circular=10),e.part.indexOf("1")>=0&&(this.Circular=11),e.part.indexOf("2")>=0&&(this.Circular=12)),this.Chord=e.check("CHORD"),e.check("LEGO",!0)&&(this.Lego=1,e.part.indexOf("0")>=0&&(this.Zero=!1),e.part.indexOf("1")>=0&&(this.Lego=11),e.part.indexOf("2")>=0&&(this.Lego=12),e.part.indexOf("3")>=0&&(this.Lego=13),e.part.indexOf("4")>=0&&(this.Lego=14),l=e.part,e.part.indexOf("Z")>=0&&(this.Zscale=!0),e.part.indexOf("H")>=0&&(this.Zvert=!1)),e.check("R3D_",!0)&&(this.Render3D=Z.Render3D.fromString(e.part.toLowerCase())),e.check("POL")&&(this.System=E),e.check("CYL")&&(this.System=ct),e.check("SPH")&&(this.System=ut),e.check("PSR")&&(this.System=mt),e.check("SURF",!0)&&(this.Surf=e.partAsInt(10,1),l=e.part,e.part.indexOf("Z")>=0&&(this.Zscale=!0),e.part.indexOf("H")>=0&&(this.Zvert=!1)),e.check("TF3",!0)&&(l=e.part),e.check("ISO",!0)&&(l=e.part),e.check("LIST")&&(this.List=!0),e.check("CONT",!0)&&s>1&&(this.Contour=1,e.part.indexOf("Z")>=0&&(this.Zscale=!0),e.part.indexOf("H")>=0&&(this.Zvert=!1),e.part.indexOf("1")>=0?this.Contour=11:e.part.indexOf("2")>=0?this.Contour=12:e.part.indexOf("3")>=0?this.Contour=13:e.part.indexOf("4")>=0&&(this.Contour=14)),e.check("HBAR",!0)?this.BarStyle=20:e.check("BAR",!0)&&(this.BarStyle=10),this.BarStyle>0&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=e.partAsInt()),e.check("ARR")&&(this.Arrow=!0),e.check("BOX",!0)&&(this.BoxStyle=10,e.part.indexOf("1")>=0?this.BoxStyle=11:e.part.indexOf("2")>=0?this.BoxStyle=12:e.part.indexOf("3")>=0&&(this.BoxStyle=13),e.part.indexOf("Z")>=0&&(this.Zscale=!0),e.part.indexOf("H")>=0&&(this.Zvert=!1)),this.Box=this.BoxStyle>0,e.check("CJUST")&&(this.Cjust=!0),e.check("COL7")&&(this.Color=7),e.check("COL")&&(this.Color=!0),e.check("CHAR")&&(this.Char=1),e.check("ALLFUNC")&&(this.AllFunc=!0),e.check("FUNC")&&(this.Func=!0,this.Hist=!1),e.check("HAXISG")&&(this.Axis=3,this.SwapXY=1),e.check("HAXIS")&&(this.Axis=1,this.SwapXY=1),e.check("HAXIG")&&(this.Axis=2,this.SwapXY=1),e.check("AXISG")&&(this.Axis=3),e.check("AXIS")&&(this.Axis=1),e.check("AXIG")&&(this.Axis=2),e.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,this.TextAngle=Math.min(e.partAsInt(),90),e.part.indexOf("N")>=0&&(this.TextKind="N"),e.part.indexOf("E0")>=0&&(this.TextLine=!0),e.part.indexOf("E")>=0&&(this.TextKind="E")),e.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(e.part),(!Number.isFinite(this.ScatCoef)||this.ScatCoef<=0)&&(this.ScatCoef=1)),e.check("SCAT")&&(this.Scat=!0),e.check("TRI",!0)&&(this.Color=!1,this.Tri=1,l=e.part,e.part.indexOf("ERR")>=0&&(this.Error=!0)),e.check("AITOFF")&&(this.Proj=1),e.check("MERCATOR")&&(this.Proj=2),e.check("SINUSOIDAL")&&(this.Proj=3),e.check("PARABOLIC")&&(this.Proj=4),e.check("MOLLWEIDE")&&(this.Proj=5),this.Proj>0&&(this.Contour=14),e.check("PROJXY",!0)){let c=!0;t?._typename===G&&e.part&&!Number.isInteger(Number.parseInt(e.part))&&(this.Profile2DProj=e.part,c=e.check("PROJXY",!0)),c&&(this.Project="XY"+e.partAsInt(0,1))}e.check("PROJX",!0)&&(t?._typename===v?this.ProfileProj=e.part||"B":this.Project="X"+e.part),e.check("PROJY",!0)&&(this.Project="Y"+e.part),e.check("PROJ")&&(this.Project="Y1"),l&&(l.indexOf("FB")>=0&&(this.FrontBox=!1),l.indexOf("BB")>=0&&(this.BackBox=!1)),s===3&&e.check("FB")&&(this.FrontBox=!1),s===3&&e.check("BB")&&(this.BackBox=!1),e.check("PFC")&&!this._pfc&&(this._pfc=2),(e.check("PLC")||this.AutoColor)&&!this._plc&&(this._plc=2),e.check("PMC")&&!this._pmc&&(this._pmc=2);const h=(c,u,m)=>{if(u==="fZaxis"&&s<3&&!this.Lego&&!this.Surf)return;let S=e.check(c);n&&n["$"+c]&&(S=!0,n["$"+c]=void 0),S&&t&&t[u].SetBit(m,!0)};if(h("OTX","fXaxis",x.kOppositeTitle),h("OTY","fYaxis",x.kOppositeTitle),h("OTZ","fZaxis",x.kOppositeTitle),h("CTX","fXaxis",x.kCenterTitle),h("CTY","fYaxis",x.kCenterTitle),h("CTZ","fZaxis",x.kCenterTitle),h("MLX","fXaxis",x.kMoreLogLabels),h("MLY","fYaxis",x.kMoreLogLabels),h("MLZ","fZaxis",x.kMoreLogLabels),h("NOEX","fXaxis",x.kNoExponent),h("NOEY","fYaxis",x.kNoExponent),h("NOEZ","fZaxis",x.kNoExponent),(e.check("RX")||n?.$RX)&&(this.RevX=!0),(e.check("RY")||n?.$RY)&&(this.RevY=!0),e.check("L")&&(this.Line=!0,this.Hist=!1),e.check("F")&&(this.Fill=!0,this.need_fillcol=!0),e.check("A")&&(this.Axis=-1),n?.$ratio_pad==="up")this.Same||(this.Axis=0),t.fXaxis.fLabelSize=0,t.fXaxis.fTitle="",t.fYaxis.$use_top_pad=!0;else if(n?.$ratio_pad==="low"){this.Same||(this.Axis=0),t.fXaxis.$use_top_pad=!0,t.fYaxis.$use_top_pad=!0,t.fXaxis.fTitle="x";const c=a?.getCanvPainter().findPainterFor(null,"upper_pad",ht)?.getFramePainter();c&&(a.zoom_xmin=c.scale_xmin,a.zoom_xmax=c.scale_xmax)}e.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0),e.check("B")&&(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0),e.check("C")&&(this.Curve=!0,this.Hist=!1),e.check("][")&&(this.Off=1,this.Hist=!0),e.check("HIST")&&(this.Hist=!0,this.Func=!0,this.Error=!1),this.Bar=this.BarStyle>0,delete this.MarkStyle,e.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0),e.check("P")&&(this.Mark=!0,this.Hist=!1,this.Zero=!1),e.check("HZ")&&(this.Zscale=!0,this.Zvert=!1),e.check("Z")&&(this.Zscale=!0),e.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1),e.check("H")&&(this.Hist=!0),e.check("E",!0)&&(this.Error=!0,s===1&&(this.Zero=!1,this.Hist===1&&(this.Hist=!1),Number.isInteger(parseInt(e.part[0]))&&(this.ErrorKind=parseInt(e.part[0])),(this.ErrorKind===3||this.ErrorKind===4)&&(this.need_fillcol=!0),this.ErrorKind===0&&(this.Zero=!0),e.part.indexOf("X0")>=0&&(this.errorX=0))),e.check("9")&&(this.HighRes=1),e.check("0")&&(this.Zero=!1),this.Color&&e.check("1")&&(this.Zero=!1),(this.Lego>0||s===3||(this.Surf>0||this.Error)&&s===2)&&(this.Mode3D=!0),a?.isTF1()&&s===1&&this.Hist===1&&!this.Line&&!this.Fill&&!this.Curve&&!this.Mark&&(this.Hist=!1,this.Curve=D.FuncAsCurve,this.Line=!this.Curve,this.Fill=!0),this.Surf===15&&(this.System===E||this.System===b)&&(this.Surf=13)}swap_xy(){return this.BarStyle>=20||this.SwapXY}asString(i,s){let t="",r="";return this.Zscale&&(r=this.Zvert?"Z":"HZ"),this.Mode3D?(this.Lego?(t="LEGO",this.Zero||(t+="0"),this.Lego>10&&(t+=this.Lego-10),t+=r):this.Surf&&(t="SURF"+(this.Surf-10),t+=r),this.FrontBox||(t+="FB"),this.BackBox||(t+="BB"),this.x3dscale!==1&&(t+=`_X3DSC${Math.round(this.x3dscale*100)}`),this.y3dscale!==1&&(t+=`_Y3DSC${Math.round(this.y3dscale*100)}`)):(this.Candle?t="CANDLE"+this.Candle:this.Violin?t="VIOLIN"+this.Violin:this.Scat?t="SCAT":this.Color?(t="COL",this.Zero||(t+="0"),t+=r,this.Axis<0&&(t+="A")):this.Contour?(t="CONT",this.Contour>10&&(t+=this.Contour-10),t+=r):this.Bar?t=this.BaseLine===!1?"B":"B1":this.Mark?t=this.Zero?"P0":"P":this.Line?(t+="L",this.Fill&&(t+="F")):this.Off&&(t="]["),this.Error&&(t+="E",this.ErrorKind>=0&&(t+=this.ErrorKind),this.errorX===0&&(t+="X0")),this.Cjust&&(t+=" CJUST"),this.Hist===!0&&(t+="HIST"),this.Text&&(t+="TEXT",this.TextAngle&&(t+=this.TextAngle),t+=this.TextKind)),this.Palette&&this.canHavePalette()&&(t+=`_PAL${this.Palette}`),this.is3d()&&this.Ortho&&i&&(t+="_ORTHO"),this.ProfileProj&&(t+="_PROJX"+this.ProfileProj),this.Profile2DProj&&(t+="_PROJXY"+this.Profile2DProj),this.Proj&&(t+="_PROJ"+this.Proj),this.ShowEmpty&&(t+="_SHOWEMPTY"),this.Same?t+=this.ForceStat?"SAMES":"SAME":i&&t&&(this.ForceStat||this.StatEnabled===!0?t+="_STAT":(this.NoStat||this.StatEnabled===!1)&&(t+="_NOSTAT")),i&&s&&t&&(s.fLogx===2?t+="_LOG2X":s.fLogx&&(t+="_LOGX"),s.fLogy===2?t+="_LOG2Y":s.fLogy&&(t+="_LOGY"),s.fLogz===2?t+="_LOG2Z":s.fLogz&&(t+="_LOGZ"),s.fGridx&&(t+="_GRIDX"),s.fGridy&&(t+="_GRIDY"),s.fTickx&&(t+="_TICKX"),s.fTicky&&(t+="_TICKY"),s.fTickz&&(t+="_TICKZ")),this.cutg_name&&(t+=` [${this.cutg_name}]`),t}exact_values_range(){return this.ohmin&&this.ohmax}}class Ct{constructor(i,s){this.arr=[],this.colzmin=i,this.colzmax=s,this.below_min_indx=-1,this.exact_min_indx=0}getLevels(){return this.arr}createNormal(i,s,t){if(s){this.colzmax<=0&&(this.colzmax=1),this.colzmin<=0&&(t===void 0||t<=0?this.colzmin=1e-4*this.colzmax:this.colzmin=t<3||t>100?.3*t:1),this.colzmin>=this.colzmax&&(this.colzmin=1e-4*this.colzmax);const r=Math.log(this.colzmin)/Math.log(10),n=Math.log(this.colzmax)/Math.log(10),a=(n-r)/i;this.arr.push(this.colzmin);for(let e=1;e<i;e++)this.arr.push(Math.exp((r+a*e)*Math.log(10)));this.arr.push(this.colzmax),this.custom=!0}else{this.colzmin===this.colzmax&&this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),this.colzmin-=.01*Math.abs(this.colzmin));const r=(this.colzmax-this.colzmin)/i;for(let n=0;n<=i;n++)this.arr.push(this.colzmin+r*n)}}createCustom(i){this.custom=!0;for(let s=0;s<i.length;++s)this.arr.push(i[s]);this.colzmax>this.arr.at(-1)&&this.arr.push(this.colzmax)}configIndicies(i,s){this.below_min_indx=i,this.exact_min_indx=s}getContourIndex(i){if(i<this.colzmin)return this.below_min_indx;if(i===this.colzmin)return this.exact_min_indx;if(!this.custom)return Math.floor(.01+(i-this.colzmin)*(this.arr.length-1)/(this.colzmax-this.colzmin));let s=0,t=this.arr.length-1;if(i<this.arr[0])return-1;if(i>=this.arr[t])return t;for(;s<t-1;){const r=Math.round((s+t)/2);this.arr[r]>i?t=r:s=r}return s}getPaletteColor(i,s){const t=this.getContourIndex(s);if(t<0)return null;const r=i.calcColorIndex(t,this.arr.length);return i.getColor(r)}getPaletteIndex(i,s){const t=this.getContourIndex(s);return t<0?null:i.calcColorIndex(t,this.arr.length)}}class H{#i;#e;#n;#t;#s;constructor(i,s,t,r){this.#t=i,this.#s=s;const n=[],a=[],e=r===!0;this.#e=[],this.#n=[],e||s?.forEachPainterInPad(f=>{f.isSecondary(i)&&f.getSecondaryId()?.match(/^func_|^indx_/)&&n.push(f)},"objects");for(let f=0;f<t?.arr.length;++f){const o=t.arr[f],l=t.opt[f];if(!o?._typename||C(i.needDrawFunc)&&!i.needDrawFunc(i.getObject(),o))continue;let h=null,c=-1;if(!e){for(let u=0;u<n.length;++u)if(n[u].matchObjectType(o._typename)&&n[u].getObjectName()===o.fName){h=n[u],c=u;break}!h&&o.fName&&(h=s?.findPainterFor(null,o.fName,o._typename))}h?(h.updateObject(o,l),c>=0&&(n.splice(c,1),a.push(h))):(this.#e[f]=o,this.#n[f]=l)}if($(r)){const f=n.indexOf(r);f>=0&&n.splice(f,1)}n.length&&s?.cleanPrimitives(f=>n.indexOf(f)>=0),a.length&&(this.#i=a)}drawNext(i){if(this.#i){const a=this.#i.shift();return this.#i.length||(this.#i=void 0),U(a.redraw()).then(()=>this.drawNext(0))}if(!this.#e||i>=this.#e.length)return this.#e=this.#n=void 0,Promise.resolve(this.#t);const s=this.#e[i],t=this.#n[i];if(!s||this.#s?.findPainterFor(s))return this.drawNext(i+1);const r=s?.fName?`func_${s.fName}`:`indx_${i}`;return s.$main_painter=this.#t,(L.canDraw(s)?L.draw(this.#s,s,t):this.#s.drawObject(this.#s,s,t)).then(a=>(a.setSecondaryId(this.#t,r),this.drawNext(i+1)))}}const pt=z(10),R=z(16),_=z(17);class Pt extends W{#i;#e;#n;#t;#s;#r;constructor(i,s){super(i,s),this.draw_content=!0,this.nbinsx=this.nbinsy=0,this.mode3d=!1}getHisto(){return this.getObject()}getAxis(i){const s=this.getObject();switch(i){case"x":return s?.fXaxis;case"y":return s?.fYaxis;case"z":return s?.fZaxis}return null}isTProfile(){return this.matchObjectType(v)}isTF1(){return!1}isTH1K(){return this.matchObjectType("TH1K")}isTH2Poly(){return this.matchObjectType(/^TH2Poly/)||this.matchObjectType(/^TProfile2Poly/)}clear3DScene(){const i=this.getFramePainter();C(i?.create3DScene)&&i.create3DScene(-1),this.mode3d=!1}cleanup(){this.clear3DScene(),this.clearHistPalette(),this.#r=void 0,super.cleanup()}getDimension(){const i=this.getHisto();return i?i._typename.match(/^TH2/)||i._typename===G?2:i._typename.match(/^TH3/)||i._typename===K?3:this.isTH2Poly()?2:1:0}decodeOptions(i){const s=this.getHisto(),t=this.getDimension(),r=this.getPadPainter(),n=r?.getRootPad(!0);let a=this.getOptions(!0);a?.reset?a.reset():a=this.setOptions(new gt,!0),this.lineatt?.setUsed(!1),this.fillatt?.setUsed(!1),this.markeratt?.setUsed(!1),a.decode(i||s.fOption,t,s,r,n,this),this.storeDrawOpt(i)}copyOptionsFrom(i){if(i===this)return;const s=this.getOptions(),t=i.getOptions();s.Mode3D=t.Mode3D,s.Zero=t.Zero,t.Mode3D?(s.Lego=t.Lego,s.Surf=t.Surf):(s.Color=t.Color,s.Contour=t.Contour)}copyOptionsToOthers(){this.forEachPainter(i=>{i!==this&&C(i.copyOptionsFrom)&&i.copyOptionsFrom(this)},"objects")}scanContent(){}checkPadRange(){this.isMainPainter()&&(this.check_pad_range=this.getOptions().Same?"pad_range":!0)}createHistDrawAttributes(i){const s=this.getHisto(),t=this.getOptions();if(t._pfc>1||t._plc>1||t._pmc>1){const r=this.getPadPainter();if(C(r?.getAutoColor)){const n=r.getAutoColor(s.$num_histos);this.#t="",t._pfc>1&&(t._pfc=1,s.fFillColor=n,this.#t+=`SetFillColor(${n});;`,this.deleteAttr("fill")),t._plc>1&&(t._plc=1,s.fLineColor=n,this.#t+=`SetLineColor(${n});;`,this.deleteAttr("line")),t._pmc>1&&(t._pmc=1,s.fMarkerColor=n,this.#t+=`SetMarkerColor(${n});;`,this.deleteAttr("marker"))}}i?this.deleteAttr():(this.createAttFill({attr:s,color:t.histoFillColor,pattern:t.histoFillPattern,kind:1}),this.createAttLine({attr:s,color0:t.histoLineColor,width:t.histoLineWidth}))}updateAxes(i,s,t){const r=(n,a,e)=>{n.fTitle=a.fTitle,n.fLabels=a.fLabels,n.fXmin=a.fXmin,n.fXmax=a.fXmax,n.fTimeDisplay=a.fTimeDisplay,n.fTimeFormat=a.fTimeFormat,n.fAxisColor=a.fAxisColor,n.fLabelColor=a.fLabelColor,n.fLabelFont=a.fLabelFont,n.fLabelOffset=a.fLabelOffset,n.fLabelSize=a.fLabelSize,n.fNdivisions=a.fNdivisions,n.fTickLength=a.fTickLength,n.fTitleColor=a.fTitleColor,n.fTitleFont=a.fTitleFont,n.fTitleOffset=a.fTitleOffset,n.fTitleSize=a.fTitleSize,e&&(n.fFirst=a.fFirst,n.fLast=a.fLast,n.fBits=a.fBits)};r(i.fXaxis,s.fXaxis,this.hasSnapId()&&!t?.zoomChangedInteractive("x")),r(i.fYaxis,s.fYaxis,this.hasSnapId()&&!t?.zoomChangedInteractive("y")),r(i.fZaxis,s.fZaxis,this.hasSnapId()&&!t?.zoomChangedInteractive("z"))}updateObject(i,s){const t=this.getHisto(),r=this.getFramePainter(),n=this.getPadPainter(),a=this.getOptions();if(i!==t){if(!this.matchObjectType(i))return!1;const e=n?.findPainterFor(this.findStat());t.TestBit(T)!==i.TestBit(T)&&(t.SetBit(T,i.TestBit(T)),e&&(e.Enabled=!t.TestBit(T)&&!a.NoStat,e.Enabled||e.removeG())),t.SetBit(R,i.TestBit(R)),this.hasSnapId()&&(t.fName=i.fName,a._pfc=a._plc=a._pmc=0),a._pfc||(t.fFillColor=i.fFillColor),t.fFillStyle=i.fFillStyle,a._plc||(t.fLineColor=i.fLineColor),t.fLineStyle=i.fLineStyle,t.fLineWidth=i.fLineWidth,a._pmc||(t.fMarkerColor=i.fMarkerColor),t.fMarkerSize=i.fMarkerSize,t.fMarkerStyle=i.fMarkerStyle,t.fEntries=i.fEntries,t.fTsumw=i.fTsumw,t.fTsumwx=i.fTsumwx,t.fTsumwx2=i.fTsumwx2,t.fXaxis.fNbins=i.fXaxis.fNbins,this.getDimension()>1&&(t.fTsumwy=i.fTsumwy,t.fTsumwy2=i.fTsumwy2,t.fTsumwxy=i.fTsumwxy,t.fYaxis.fNbins=i.fYaxis.fNbins,this.getDimension()>2&&(t.fTsumwz=i.fTsumwz,t.fTsumwz2=i.fTsumwz2,t.fTsumwxz=i.fTsumwxz,t.fTsumwyz=i.fTsumwyz,t.fZaxis.fNbins=i.fZaxis.fNbins)),this.updateAxes(t,i,r),t.fArray=i.fArray,t.fNcells=i.fNcells,t.fTitle=i.fTitle,t.fMinimum=i.fMinimum,t.fMaximum=i.fMaximum,t.fSumw2=i.fSumw2,a.ominimum||(a.minimum=t.fMinimum),a.omaximum||(a.maximum=t.fMaximum),this.getDimension()===1&&a.decodeSumw2(t),this.isTProfile()?t.fBinEntries=i.fBinEntries:this.isTH1K()?(t.fNIn=i.fNIn,t.fReady=0):this.isTH2Poly()&&(t.fBins=i.fBins),this.#s=new H(this,n,i.fFunctions,e);const f=t.fOption!==i.fOption;t.fOption=i.fOption,(s!==void 0&&a.original!==s||f)&&this.decodeOptions(s||t.fOption)}return a.ominimum||(a.minimum=t.fMinimum),a.omaximum||(a.maximum=t.fMaximum),!a.ominimum&&!a.omaximum&&a.minimum===a.maximum&&(a.minimum=a.maximum=g),(!r||!r.zoomChangedInteractive())&&this.checkPadRange(),this.scanContent(),this.histogram_updated=!0,!0}accessMM(i,s){const t=i?"minimum":"maximum",r=this.getOptions();if(s===void 0)return r[t];r[t]=s,this.interactiveRedraw("pad",i?`exec:SetMinimum(${s})`:`exec:SetMaximum(${s})`)}extractAxesProperties(i){const s=n=>{n.fXbins.length>=n.fNbins?(n.GetBinCoord=function(a){const e=Math.round(a);if(e<=0)return this.fXmin;if(e>this.fNbins)return this.fXmax;if(e===a)return this.fXbins[e];const f=a<e?e-1:e+1;return this.fXbins[e]*Math.abs(a-f)+this.fXbins[f]*Math.abs(a-e)},n.FindBin=function(a,e){for(let f=1;f<this.fXbins.length;++f)if(a<this.fXbins[f])return Math.floor(f-1+e);return this.fNbins}):(n.$binwidth=(n.fXmax-n.fXmin)/(n.fNbins||1),n.GetBinCoord=function(a){return this.fXmin+a*this.$binwidth},n.FindBin=function(a,e){return Math.floor((a-this.fXmin)/this.$binwidth+e)})};this.nbinsx=this.nbinsy=this.nbinsz=0;const t=this.getHisto(),r=this.getOptions();this.nbinsx=t.fXaxis.fNbins,this.xmin=t.fXaxis.fXmin,this.xmax=t.fXaxis.fXmax,t.fXaxis.TestBit(x.kAxisRange)&&t.fXaxis.fFirst!==t.fXaxis.fLast&&(t.fXaxis.fFirst===0&&(this.xmin=t.fXaxis.GetBinLowEdge(0)),t.fXaxis.fLast===this.nbinsx+1&&(this.xmax=t.fXaxis.GetBinLowEdge(this.nbinsx+2))),s(t.fXaxis),this.ymin=t.fYaxis.fXmin,this.ymax=t.fYaxis.fXmax,i===1&&r.exact_values_range()&&(this.ymin=r.hmin,this.ymax=r.hmax),i>1&&(this.nbinsy=t.fYaxis.fNbins,t.fYaxis.TestBit(x.kAxisRange)&&t.fYaxis.fFirst!==t.fYaxis.fLast&&(t.fYaxis.fFirst===0&&(this.ymin=t.fYaxis.GetBinLowEdge(0)),t.fYaxis.fLast===this.nbinsy+1&&(this.ymax=t.fYaxis.GetBinLowEdge(this.nbinsy+2))),s(t.fYaxis),this.zmin=t.fZaxis.fXmin,this.zmax=t.fZaxis.fXmax,i===2&&r.ohmin&&r.ohmax&&(this.zmin=r.hmin,this.zmax=r.hmax)),i>2&&(this.nbinsz=t.fZaxis.fNbins,t.fZaxis.TestBit(x.kAxisRange)&&t.fZaxis.fFirst!==t.fZaxis.fLast&&(t.fZaxis.fFirst===0&&(this.zmin=t.fZaxis.GetBinLowEdge(0)),t.fZaxis.fLast===this.nbinsz+1&&(this.zmax=t.fZaxis.GetBinLowEdge(this.nbinsz+2))),s(t.fZaxis))}async drawAxes(){const i=this.getFramePainter();if(!i)return!1;const s=this.getHisto(),t=this.getOptions();if(this.ymin===this.ymax&&(this.ymax+=1),!this.isMainPainter()){const n={second_x:t.AxisPos>=10,second_y:t.AxisPos%10===1,hist_painter:this};return!n.second_x&&!n.second_y||i.hasDrawnAxes(n.second_x,n.second_y)?!1:(i.setAxes2Ranges(n.second_x,s.fXaxis,this.xmin,this.xmax,n.second_y,s.fYaxis,this.ymin,this.ymax),i.createXY2(n),i.drawAxes2(n.second_x,n.second_y))}if(i.setAxesRanges(s.fXaxis,this.xmin,this.xmax,s.fYaxis,this.ymin,this.ymax,s.fZaxis,0,0),i.createXY({ndim:this.getDimension(),check_pad_range:this.check_pad_range,zoom_xmin:this.zoom_xmin,zoom_xmax:this.zoom_xmax,zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,xmin_nz:s.$xmin_nz,ymin_nz:this.ymin_nz??s.$ymin_nz,swap_xy:t.swap_xy(),xticks:t.xticks,yticks:t.yticks,reverse_x:t.RevX,reverse_y:t.RevY,symlog_x:t.SymlogX,symlog_y:t.SymlogY,Proj:t.Proj,extra_y_space:t.Text&&t.BarStyle>0,hist_painter:this}),delete this.check_pad_range,delete this.zoom_xmin,delete this.zoom_xmax,delete this.zoom_ymin,delete this.zoom_ymax,t.Same)return!1;const r=t.Axis<0||t.Axis===2;return i.drawAxes(!1,r,r,t.AxisPos,t.Zscale&&t.Zvert,t.Zscale&&!t.Zvert,t.Axis!==1)}processOnlineChange(i){const s=this.getCanvPainter();C(s?.processChanges)&&s.processChanges(i,this)}fillWebObjectOptions(i){this.#t&&i&&(i.fcust="auto_exec:"+this.#t,this.#t=void 0)}toggleTitle(i){const s=this.getHisto();if(!this.isMainPainter()||!s)return!1;if(i===A)return!s.TestBit(_);s.InvertBit(_),this.updateHistTitle().then(()=>this.processOnlineChange(`exec:SetBit(TH1::kNoTitle,${s.TestBit(_)?1:0})`))}async updateHistTitle(){const i=this.getOptions();if(!this.isMainPainter()||i.Same||i.Axis>0)return this;const s=this.getPadPainter()?.findPainterFor(null,y,M),t=s?.getObject();if(!s||!t)return this;const r=this.getHisto(),n=!r.TestBit(_)&&d.fOptTitle>0;return t.Clear(),n&&t.AddText(r.fTitle),s.redraw().then(()=>this)}async drawHistTitle(){const i=this.getOptions();if(!this.isMainPainter()||i.Same||i.Axis>0)return this;const s=this.getHisto(),t=d,r=!s.TestBit(_)&&t.fOptTitle>0,n=this.getPadPainter();let a=n.findInPrimitives(y,M);return a?(a.Clear(),r&&a.AddText(s.fTitle),this):(a=N(M),Object.assign(a,{fName:y,fOption:"blNDC",fFillColor:t.fTitleColor,fFillStyle:t.fTitleStyle,fBorderSize:t.fTitleBorderSize,fTextFont:t.fTitleFont,fTextSize:t.fTitleFontSize,fTextColor:t.fTitleTextColor,fTextAlign:22}),r&&a.AddText(s.fTitle),L.draw(n,a,lt).then(e=>(e?.setSecondaryId(this,y),this)))}processTitleChange(i){const s=this.getHisto(),t=this.getPadPainter()?.findPainterFor(null,y);if(!s||!t)return null;if(i==="check")return!this.isMainPainter()||this.getOptions().Same?null:s;t.clearPave(),t.addText(s.fTitle),t.redraw(),this.submitCanvExec(`SetTitle("${s.fTitle}")`)}updateStatWebCanvas(){if(!this.hasSnapId())return;const i=this.findStat(),s=this.getPadPainter()?.findPainterFor(i);s&&!s.hasSnapId()&&s.redraw()}findStat(){return this.findFunction(I,"stats")}toggleStat(i){const s=this.getPadPainter();let t=this.findStat(),r;if(i||(i=""),t)r=s.findPainterFor(t);else{if(i.indexOf("-check")>0)return!1;t=this.createStat(!0)}if(i===A)return r?.Enabled||!1;if(i==="fitpar-check")return t?.fOptFit||!1;if(i==="fitpar-toggle")return t?(t.fOptFit=t.fOptFit?0:1111,r?.redraw(),!0):!1;let n;return r?(r.Enabled=!r.Enabled,this.getOptions().StatEnabled=r.Enabled,r.redraw(),n=r.Enabled):n=L.draw(s,t),this.processOnlineChange(`exec:SetBit(TH1::kNoStats,${n?0:1})`,this),n}isIgnoreStatsFill(){return!this.getObject()||!this.draw_content&&!this.create_stats&&!this.hasSnapId()}createStat(i){const s=this.getHisto(),t=this.getOptions();if(!s||!i&&!t.ForceStat&&(t.NoStat||s.TestBit(T)||!D.AutoStat||!this.isMainPainter()))return null;const r=d;let n=this.findStat(),a=t.optstat,e=t.optfit;return a!==void 0?(n&&(n.fOptStat=a),t.optstat=void 0):a=s.$custom_stat||r.fOptStat,e!==void 0?(n&&(n.fOptFit=e),t.optfit=void 0):e=r.fOptFit,!n&&!a&&!e?null:(this.create_stats=!0,n||(n=N(I),Object.assign(n,{fName:"stats",fOptStat:a,fOptFit:e,fX1NDC:r.fStatX-r.fStatW,fY1NDC:r.fStatY-r.fStatH,fX2NDC:r.fStatX,fY2NDC:r.fStatY,fTextAlign:12}),n.AddText(s.fName),this.addFunction(n),n))}findFunction(i,s){const t=this.getHisto()?.fFunctions?.arr;if(!t)return null;for(let r=0;r<t.length;++r){const n=t[r];if(!(s&&n.fName!==s)&&n._typename===i)return n}return null}addFunction(i,s){const t=this.getHisto();!t||!i||(t.fFunctions||(t.fFunctions=N(V)),s?t.fFunctions.AddFirst(i):t.fFunctions.Add(i))}needDrawFunc(i,s){const t=this.getOptions();return s._typename===I?s.fName!=="stats"||!i.TestBit(T)&&!t.NoStat:s._typename===J||s._typename===q?t.AllFunc||!s.TestBit(z(9)):s._typename==="TGraphDelaunay"||s._typename==="TGraphDelaunay2D"?!1:s._typename!==O}async drawFunctions(){return new H(this,this.getPadPainter(),this.getHisto().fFunctions,!0).drawNext(0)}async updateFunctions(){const i=this.#s?.drawNext(0)??this;return this.#s=void 0,i}getSelectIndex(i,s,t){let r,n=this.getAxis(i);const a=this[`nbins${i}`]??0,e=this.getOptions();e.second_x&&i==="x"&&(i="x2"),e.second_y&&i==="y"&&(i="y2");const f=this.getFramePainter(),o=f?f[`zoom_${i}min`]:0,l=f?f[`zoom_${i}max`]:0;return o!==l&&n?(s==="left"?r=n.FindBin(o,t||0):r=n.FindBin(l,(t||0)+.5),r<0?r=0:r>a&&(r=a)):r=s==="left"?0:a,n&&(n.fFirst===n.fLast||!n.TestBit(x.kAxisRange)||n.fFirst===1&&n.fLast===a)&&(n=null),s==="left"?(r=Math.max(r,0),n&&n.fFirst>1&&r<n.fFirst?r=n.fFirst-1:n?.fFirst===0&&(r=-1)):(r=Math.min(r,a),n&&n.fLast<=a&&r>n.fLast?r=n.fLast:n?.fLast===a+1&&(r=a+1)),r}unzoomUserRange(i,s,t){const r=this.getHisto(),n=this.getOptions();if(!r)return!1;let a=!1;const e=o=>!o||!o.TestBit(x.kAxisRange)||o.fFirst===o.fLast||o.fFirst<=1&&o.fLast>=o.fNbins?!1:(o.InvertBit(x.kAxisRange),!0),f=o=>this.getDimension()!==o||n.minimum===g&&n.maximum===g||!this.draw_content?!1:(n.minimum=n.maximum=g,this.scanContent(),!0);return i&&e(r.fXaxis)&&(a=!0),s&&(e(r.fYaxis)||f(1))&&(a=!0),t&&(e(r.fZaxis)||f(2))&&(a=!0),a}async addInteractivity(){const i=this.isMainPainter(),s=this.getOptions().AxisPos>0;return(i||s?this.getFramePainter():null)?.addInteractivity(!i&&s)??!1}changeUserRange(i,s){const t=this.getHisto(),r=t?t[`f${s}axis`]:null;if(!r)return;let n=`[1,${r.fNbins}]`;r.TestBit(x.kAxisRange)&&(n=`[${r.fFirst},${r.fLast}]`),i.input(`Enter user range for axis ${s} like [1,${r.fNbins}]`,n).then(a=>{if(!a||(a=JSON.parse(a),!a||a.length!==2))return;const e=parseInt(a[0]),f=parseInt(a[1]);!Number.isInteger(e)||!Number.isInteger(f)||(r.fFirst=e,r.fLast=f,r.SetBit(x.kAxisRange,r.fFirst<r.fLast&&r.fFirst>=1&&r.fLast<=r.fNbins),this.interactiveRedraw())})}changeValuesRange(i){const s=this.getOptions();let t;s.minimum!==g&&s.maximum!==g?t=`[${s.minimum},${s.maximum}]`:t=`[${this.gminbin},${this.gmaxbin}]`,i.input("Enter min/max hist values or empty string to reset",t).then(r=>{r=r?JSON.parse(r):[],!$(r)||r.length!==2||!Number.isFinite(r[0])||!Number.isFinite(r[1])?s.minimum=s.maximum=g:(s.minimum=r[0],s.maximum=r[1]),this.interactiveRedraw()})}executeMenuCommand(i,s){if(super.executeMenuCommand(i,s))return!0;if(i.fClassName===Q){const t=Y(i.$execid)?i.$execid.indexOf("#"):-1,r=t>0?i.$execid.slice(t+1):"x",n=this.getFramePainter();if(i.fName==="UnZoom")return n?.unzoom(r),!0;if(i.fName==="SetRange"){const a=n?.getAxis(r),e=JSON.parse(`[${s}]`);a&&e?.length===2&&n?.zoom(r,a.GetBinLowEdge(e[0]),a.GetBinLowEdge(e[1]+1))}else if(i.fName==="SetRangeUser"){const a=JSON.parse(`[${s}]`);a?.length===2&&n?.zoom(r,a[0],a[1])}}return!1}fillContextMenuItems(i){const s=this.getHisto(),t=this.getFramePainter(),r=this.getOptions();if(s){if(r.Axis<=0&&!this.isTF1()&&i.addchk(this.toggleStat(A),"Show statbox",()=>this.toggleStat()),this.isMainPainter()&&(i.sub("Title"),i.addchk(this.toggleTitle(A),"Show",()=>this.toggleTitle()),i.add("Edit",()=>i.input("Enter histogram title",s.fTitle).then(n=>{tt(s,n),this.interactiveRedraw()})),i.endsub()),this.draw_content&&(this.getDimension()===1?i.add("User range X",()=>this.changeUserRange(i,"X")):(i.sub("User ranges"),i.add("X",()=>this.changeUserRange(i,"X")),i.add("Y",()=>this.changeUserRange(i,"Y")),this.getDimension()>2?i.add("Z",()=>this.changeUserRange(i,"Z")):i.add("Values",()=>this.changeValuesRange(i)),i.endsub()),C(this.fillHistContextMenu)&&this.fillHistContextMenu(i),i.addRedrawMenu(this.getPrimary())),r.Mode3D){i.size()>0&&i.separator();const n=this.getMainPainter()||this;i.addchk(n.isTooltipAllowed(),"Show tooltips",()=>n.setTooltipAllowed("toggle")),i.addchk(t?.enable_highlight,"Highlight bins",()=>{t.enable_highlight=!t.enable_highlight,!t.enable_highlight&&t.mode3d&&C(t.highlightBin3D)&&t.highlightBin3D(null)}),C(t?.render3D)&&(i.addchk(n.options.FrontBox,"Front box",()=>{n.options.FrontBox=!n.options.FrontBox,t.render3D()}),i.addchk(n.options.BackBox,"Back box",()=>{n.options.BackBox=!n.options.BackBox,t.render3D()}),i.addchk(t.camera?.isOrthographicCamera,"Orthographic camera",a=>{n.options.Ortho=a,t.change3DCamera(a)})),this.draw_content&&(i.addchk(!r.Zero,"Suppress zeros",()=>{r.Zero=!r.Zero,this.interactiveRedraw("pad")}),(r.Lego===12||r.Lego===14)&&(i.addchk(r.Zscale,"Z scale",()=>this.toggleColz()),this.fillPaletteMenu(i,!0))),C(n.control?.reset)&&i.add("Reset camera",()=>n.control.reset())}this.histogram_updated&&t.zoomChangedInteractive()&&i.add("Let update zoom",()=>t.zoomChangedInteractive("reset"))}}getSnapId(i){return this.isTF1()&&(i==="x"||i==="y"||i==="z")&&(i="hist#"+i),super.getSnapId(i)}autoZoom(){}clickButton(i){const s=this.getFramePainter();if(!this.isMainPainter()||!s)return!1;switch(i){case"ToggleZoom":if(s.zoom_xmin!==s.zoom_xmax||s.zoom_ymin!==s.zoom_ymax||s.zoom_zmin!==s.zoom_zmax){const t=s.unzoom();return s.zoomChangedInteractive("reset"),t}if(this.draw_content)return this.autoZoom();break;case"ToggleLogX":return s.toggleAxisLog("x");case"ToggleLogY":return s.toggleAxisLog("y");case"ToggleLogZ":return s.toggleAxisLog("z");case"ToggleStatBox":return U(this.toggleStat());case"ToggleColorZ":return this.toggleColz()}return!1}fillToolbar(i){const s=this.getPadPainter();s&&(s.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),s.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),s.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),this.getDimension()>1&&s.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),s.addPadButton("statbox","Toggle stat box","ToggleStatBox"),i||s.showPadButtons())}get3DToolTip(i){const s=this.getHisto(),t={bin:i,name:s.fName,title:s.fTitle};switch(this.getDimension()){case 1:t.ix=i,t.iy=1,t.value=s.getBinContent(t.ix),t.error=s.getBinError(i),t.lines=this.getBinTooltips(i-1);break;case 2:t.ix=i%(this.nbinsx+2),t.iy=(i-t.ix)/(this.nbinsx+2),t.value=s.getBinContent(t.ix,t.iy),t.error=s.getBinError(i),t.lines=this.getBinTooltips(t.ix-1,t.iy-1);break;case 3:t.ix=i%(this.nbinsx+2),t.iy=(i-t.ix)/(this.nbinsx+2)%(this.nbinsy+2),t.iz=(i-t.ix-t.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),t.value=s.getBinContent(t.ix,t.iy,t.iz),t.error=s.getBinError(i),t.lines=this.getBinTooltips(t.ix-1,t.iy-1,t.iz-1);break}return t}createContour(i,s,t,r,n){const a=new Ct(s,t),e=this.getDimension(),f=this.isTH2Poly(),o=this.getFramePainter(),l=this.getOptions();if(n)a.createCustom(n);else{i<2&&(i=d.fNumberContours);const h=this.getPadPainter()?.getRootPad(!0),c=h?.fLogv??(e===2&&h?.fLogz);a.createNormal(i,c??0,r)}return a.configIndicies(l.Zero&&!f?-1:0,a.colzmin||!l.Zero||f?0:-1),o&&e<3&&!o.mode3d&&(o.zmin=a.colzmin,o.zmax=a.colzmax),this.#r=a,a}#f(i,s){const t=this.getOptions(),r=this!==i&&(i?.minbin!==void 0||i?.options.ohmin)&&!t.IgnoreMainScale&&!i?.tt_handle?.ScatterPlot?i:this;let n,a=r.minbin,e=r.maxbin,f=r.minposbin;a===e&&(r.options.ohmin&&r.options.ohmax?(a=r.options.hmin,e=r.options.hmax,f=Math.max(a,e*1e-10)):(a=r.gminbin,e=r.gmaxbin,f=r.gminposbin));let o=a,l=e;if(t.minimum!==g&&(a=t.minimum,o=Math.min(o,a),n=!0),t.maximum!==g&&(e=t.maximum,l=Math.max(l,e),n=!1),a>=e&&(n||!a?e=a+1:a=e-1),s?.zoomChangedInteractive("z")){const h=s.zoom_zmin!==s.zoom_zmax;a=h?s.zoom_zmin:o,e=h?s.zoom_zmax:l}return{zmin:a,zmax:e,zminpos:f,gzmin:o,gzmax:l}}getContour(i){if(i===!1||this.#r&&i!==!0)return this.#r;const s=this.getMainPainter(),t=this.getFramePainter(),r=s?.getContour(!1);if(r&&s!==this&&!this.getOptions().IgnoreMainScale)return this.#r=r,r;const n=this.getObject(),a=this.#f(s,t);let e=0,f;n.fContour?.length>1&&(n.TestBit(pt)?f=n.fContour:e=n.fContour.length);const o=this.createContour(e,a.zmin,a.zmax,a.zminpos,f);return this.getDimension()<3&&t&&(t.zmin=a.gzmin,t.zmax=a.gzmax,a.gzmin!==o.colzmin||a.gzmax!==o.colzmax?(t.zoom_zmin=o.colzmin,t.zoom_zmax=o.colzmax):t.zoom_zmin=t.zoom_zmax=0),o}getContourLevels(i){return this.getContour(i).getLevels()}getHistPalette(i){let s=i?null:this.#n;if(s)return s;const t=this.getPadPainter(),r=this.getOptions();return r.Palette||C(t?.getCustomPalette)&&(s=t.getCustomPalette()),s||(s=it(r.Palette,t?.isGrayscale())),this.#n=s,s}clearHistPalette(){this.#n=void 0}fillPaletteMenu(i,s){const t=this.getOptions();if(i.addPaletteMenu(t.Palette||D.Palette,r=>{t.Palette=parseInt(r),this.getHistPalette(!0),this.redraw()}),!s){i.add("Default position",()=>{this.drawColorPalette(t.Zscale,!1,!0).then(()=>this.processOnlineChange("drawopt"))},"Set default position for palette");const r=this.findFunction(O),n=r?r.fX2NDC-r.fX1NDC<r.fY2NDC-r.fY1NDC:!0;i.addchk(n,"Vertical",a=>{t.Zvert=a,this.drawColorPalette(t.Zscale,!1,"toggle").then(()=>this.processOnlineChange("drawopt"))},"Toggle palette vertical/horizontal flag"),i.add("Bring to front",()=>this.getPadPainter()?.findPainterFor(r)?.bringToFront())}}async drawColorPalette(i,s,t){const r=this.getOptions(),n=t==="toggle";if(r.IgnorePalette)return null;const a=this.getMainPainter();if(a&&a!==this&&a.draw_content!==!1&&a.options.Zscale)return null;const e=this.getPadPainter();let f=this.findFunction(O),o=e?.findPainterFor(f);const l=!!f;if(!o&&!f&&!r.Axis&&(o=e?.findPainterFor(void 0,void 0,O),o&&(f=o.getObject(),this.addFunction(f,!0))),!i)return o&&!r.Same&&(r.Zvert=o.isPaletteVertical(),o.Enabled=!1,o.removeG()),null;if(f)o?.isPaletteVertical()!==void 0&&!n&&(r.Zvert=o.isPaletteVertical());else{if(f=N(O),t||(t=!r.Same),f.fInit=1,f.$can_move=t,f.$generated=!0,r.Zvert?Object.assign(f,{fX1NDC:1.005-d.fPadRightMargin,fX2NDC:1.045-d.fPadRightMargin,fY1NDC:d.fPadBottomMargin,fY2NDC:1-d.fPadTopMargin}):Object.assign(f,{fX1NDC:d.fPadLeftMargin,fX2NDC:1-d.fPadRightMargin,fY1NDC:1.005-d.fPadTopMargin,fY2NDC:1.045-d.fPadTopMargin}),Object.assign(f.fAxis,{fChopt:"+",fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextAlign:11}),this.getDimension()===2){const m=this.getHisto().fZaxis;Object.assign(f.fAxis,{fTitle:m.fTitle,fTitleSize:m.fTitleSize,fTitleOffset:m.fTitleOffset,fTitleColor:m.fTitleColor,fLineColor:m.fAxisColor,fTextSize:m.fLabelSize,fTextColor:m.fLabelColor,fTextFont:m.fLabelFont,fLabelOffset:m.fLabelOffset})}this.addFunction(f,!0)}const h=this.getFramePainter();if(t&&h&&f.$can_move)if(r.Zvert){if(n){const m=f.fY2NDC-f.fY1NDC;f.fX1NDC=h.fX2NDC+.005,f.fX2NDC=f.fX1NDC+m}f.fX1NDC>(h.fX1NDC+h.fX2NDC)*.5?(f.fX2NDC=h.fX2NDC+.005+(f.fX2NDC-f.fX1NDC),f.fX1NDC=h.fX2NDC+.005):(f.fX1NDC=h.fX1NDC-.03-(f.fX2NDC-f.fX1NDC),f.fX2NDC=h.fX1NDC-.03),f.fY1NDC=h.fY1NDC,f.fY2NDC=h.fY2NDC}else{if(n){const m=f.fX2NDC-f.fX1NDC;f.fY1NDC=h.fY2NDC+.005,f.fY2NDC=f.fY1NDC+m}f.fX1NDC=h.fX1NDC,f.fX2NDC=h.fX2NDC,f.fY2NDC>(h.fY1NDC+h.fY2NDC)*.5?(f.fY2NDC=h.fY2NDC+.005+(f.fY2NDC-f.fY1NDC),f.fY1NDC=h.fY2NDC+.005):(f.fY1NDC=h.fY1NDC-.05-(f.fY2NDC-f.fY1NDC),f.fY2NDC=h.fY1NDC-.05)}f.$main_painter=this;let c="bring_stats_front",u;if(s&&(c+=";postpone"),t&&!this.#i&&(c+=";can_move"),r.Cjust&&(c+=";cjust"),!o)u=L.draw(e,f,c).then(m=>{o=m,o.setSecondaryId(this,l&&!f.$generated?`func_${f.fName}`:void 0)});else{if(o.Enabled=!0,s)return o;u=o.drawPave(c)}return u.then(()=>{r.Zvert=o.isPaletteVertical(),o.redraw=()=>{};let m=!1;if(t&&h&&!this.#i){const p=e?.getRootPad(!0);r.Zvert?(f.fX1NDC>.5&&h.fX2NDC>f.fX1NDC?(m=!0,h.fX2NDC=f.fX1NDC-.01,h.fX1NDC>h.fX2NDC-.1&&(h.fX1NDC=Math.max(0,h.fX2NDC-.1))):f.fX2NDC<.5&&h.fX1NDC<f.fX2NDC&&(m=!0,h.fX1NDC=f.fX2NDC+.05,h.fX2NDC<h.fX1NDC+.1&&(h.fX2NDC=Math.min(1,h.fX1NDC+.1))),m&&p&&(p.fLeftMargin=h.fX1NDC,p.fRightMargin=1-h.fX2NDC)):(f.fY1NDC>.5&&h.fY2NDC>f.fY1NDC?(m=!0,h.fY2NDC=f.fY1NDC-.01,h.fY1NDC>h.fY2NDC-.1&&(h.fY1NDC=Math.max(0,h.fXYNDC-.1))):f.fY2NDC<.5&&h.fY1NDC<f.fY2NDC&&(m=!0,h.fY1NDC=f.fY2NDC+.05,h.fXYNDC<h.fY1NDC+.1&&(h.fY2NDC=Math.min(1,h.fY1NDC+.1))),m&&p&&(p.fTopMargin=h.fY1NDC,p.fBottomMargin=1-h.fY2NDC))}return m?(this.#i=!0,h.redraw(),(s?Promise.resolve(!0):this.redraw()).then(()=>(this.#i=void 0,o))):o})}toggleColz(){const i=this.getOptions();if(i.canHavePalette())return i.Zscale=!i.Zscale,this.drawColorPalette(i.Zscale,!1,!0).then(()=>this.processOnlineChange("drawopt"))}toggleMode3D(){const i=this.getOptions();return i.Mode3D=!i.Mode3D,i.Mode3D&&!i.Surf&&!i.Lego&&!i.Error&&(this.nbinsx>=50||this.nbinsy>=50?i.Lego=i.Scat?13:14:i.Lego=i.Scat?1:12,i.Zero=!1),this.copyOptionsToOthers(),this.interactiveRedraw("pad","drawopt")}getHistGrFuncs(i=!0){let s;if(this.isUseFrame()){const t=this.getOptions();if(s=this.getFramePainter()?.getGrFuncs(t.second_x,t.second_y),s)return s}return s=this.getAxisToSvgFunc(!1,i,!1)||{x:t=>t,y:t=>t},s.$painter=this,s.grx=s.x,s.gry=s.y,s.logx=s.pad?.fLogx,s.logy=s.pad?.fLogy,s.swap_xy=function(){return this.fp?.swap_xy()??!1},s.getFrameWidth=function(){return this.$painter.getPadPainter().getPadWidth()},s.getFrameHeight=function(){return this.$painter.getPadPainter().getPadHeight()},s.isAxisZoomed=function(){return!1},s.revertAxis=function(t,r){return this.$painter.svgToAxis(t,r)},s.axisAsText=function(t,r){return r.toString()},s}prepareDraw(i){i||(i={rounding:!0,extra:0,middle:0}),i.extra===void 0&&(i.extra=0),i.middle===void 0&&(i.middle=0),i.pixel_density&&(i.rounding=!0);const s=this.getHisto(),t=this.getOptions(),r=s.fXaxis,n=s.fYaxis,a=this.getHistGrFuncs(i.rounding),e=this.getDimension(),f={i1:i.nozoom?0:this.getSelectIndex("x","left",0-i.extra),i2:i.nozoom?this.nbinsx:this.getSelectIndex("x","right",1+i.extra),j1:e===1||i.nozoom?0:this.getSelectIndex("y","left",0-i.extra),j2:e===1?1:i.nozoom?this.nbinsy:this.getSelectIndex("y","right",1+i.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1,width:a?.getFrameWidth()??600,height:a?.getFrameHeight()??400};if((i.use3d&&!a.size_x3d||!a.size_y3d)&&(i.use3d=!1),i.cutg){let p=f.i2,F=f.i1,B=f.j2,w=f.j1;for(let P=f.i1;P<f.i2;++P)for(let k=f.j1;k<f.j2;++k)i.cutg.IsInside(r.GetBinCoord(P+i.middle),n.GetBinCoord(k+i.middle))&&(p=Math.min(p,P),F=Math.max(F,P+1),B=Math.min(B,k),w=Math.max(w,k+1));Object.assign(f,{i1:p,i2:F,j1:B,j2:w})}let o,l,h,c,u,m;for(f.grx=f.i1<0?{}:new Float32Array(f.i2+1),f.gry=f.j1<0?{}:new Float32Array(f.j2+1),typeof s.fBarOffset=="number"&&typeof s.fBarWidth=="number"&&(s.fBarOffset||s.fBarWidth!==1e3)&&(s.fBarOffset<=1e3?f.xbar1=f.ybar1=.001*s.fBarOffset:s.fBarOffset<=3e3?f.xbar1=.001*(s.fBarOffset-2e3):s.fBarOffset<=5e3&&(f.ybar1=.001*(s.fBarOffset-4e3)),s.fBarWidth<=1e3?(f.xbar2=Math.min(1,f.xbar1+.001*s.fBarWidth),f.ybar2=Math.min(1,f.ybar1+.001*s.fBarWidth)):s.fBarWidth<=3e3?f.xbar2=Math.min(1,f.xbar1+.001*(s.fBarWidth-2e3)):s.fBarWidth<=5e3&&(f.ybar2=Math.min(1,f.ybar1+.001*(s.fBarWidth-4e3)))),i.original&&(f.original=!0,f.origx=f.i1<0?{}:new Float32Array(f.i2+1),f.origy=f.j1<0?{}:new Float32Array(f.j2+1)),o=f.i1;o<=f.i2;++o){if(h=r.GetBinCoord(o+i.middle),a.logx&&h<=0){f.i1=o+1;continue}f.origx&&(f.origx[o]=h),f.grx[o]=a.grx(h),i.rounding&&(f.grx[o]=Math.round(f.grx[o])),i.use3d&&(f.grx[o]<-a.size_x3d&&(f.grx[o]=-a.size_x3d,t.RevX?f.i2=o:f.i1=o),f.grx[o]>a.size_x3d&&(f.grx[o]=a.size_x3d,t.RevX?f.i1=o:f.i2=o))}if(e===1)f.gry[0]=a.gry(0),f.gry[1]=a.gry(1);else for(l=f.j1;l<=f.j2;++l){if(c=n.GetBinCoord(l+i.middle),a.logy&&c<=0){f.j1=l+1;continue}f.origy&&(f.origy[l]=c),f.gry[l]=a.gry(c),i.rounding&&(f.gry[l]=Math.round(f.gry[l])),i.use3d&&(f.gry[l]<-a.size_y3d&&(f.gry[l]=-a.size_y3d,t.RevY?f.j2=l:f.j1=l),f.gry[l]>a.size_y3d&&(f.gry[l]=a.size_y3d,t.RevY?f.j1=l:f.j2=l))}let S=!0;for(this.minposbin=0,o=f.i1;o<f.i2;++o)for(l=f.j1;l<f.j2;++l){if(u=s.getBinContent(o+1,l+1),f.sumz+=u,i.pixel_density){if(m=(f.grx[o+1]-f.grx[o])*(f.gry[l]-f.gry[l+1]),m<=0)continue;f.max=Math.max(f.max,u),u>0&&(u<f.min||f.min===0)&&(f.min=u),u/=m}S?(this.maxbin=this.minbin=u,S=!1):(this.maxbin=Math.max(this.maxbin,u),this.minbin=Math.min(this.minbin,u)),u>0&&(this.minposbin===0||u<this.minposbin)&&(this.minposbin=u)}return S&&(this.maxbin=this.minbin=0),this.#r=void 0,i.zrange&&Object.assign(f,this.#f(this.getMainPainter(),this.getFramePainter())),f}getAxisBinTip(i,s,t){const r=this.getHistGrFuncs(),n=r[`${i}_handle`],a=s.GetBinLowEdge(t+1);if(n.kind===et)return r.axisAsText(i,a);const e=s.GetBinLowEdge(t+2);return n.kind===st||this.isTF1()?r.axisAsText(i,(a+e)/2):`[${r.axisAsText(i,a)}, ${r.axisAsText(i,e)})`}getBinErrors(i,s,t){const r=i.getBinError(s),n={low:r,up:r},a=this.getOptions().Poisson||i.fBinStatErrOpt;if(!a||i.fSumw2.fN&&i.fTsumw!==i.fTsumw2||t<0)return n;const e=a===j?.05:1-.682689492,f=Math.round(t);return n.poisson=!0,n.low=f===0?0:t-nt(e/2,f,1),n.up=rt(e/2,f+1,1)-t,n}_checkAssign(){const i=this.getPadPainter()?.getMainPainter();this.getOptions().Same?this.#e=!i:i||this.setAsMainPainter()}isUseFrame(){return!this.#e}static async _drawHist(i,s){const t=!Y(s)||s.toLowerCase().indexOf("same")<0;return ft(i,t).then(()=>(i.decodeOptions(s),i._checkAssign(),i.isTH2Poly()&&i.options.Mode3D&&(i.options.Lego=12),i.checkPadRange(),i.scanContent(),i.createStat(),i.callDrawFunc())).then(()=>i.drawFunctions()).then(()=>i.drawHistTitle()).then(()=>{if(!i.Mode3D&&i.options.AutoZoom)return i.autoZoom()}).then(()=>{if(i.options.Project&&!i.mode3d&&C(i.toggleProjection))return i.toggleProjection(i.options.Project)}).then(()=>(i.fillToolbar(),i))}}export{H as F,Ct as H,Pt as T,E as a,ct as b,ut as c,mt as d,b as k};
