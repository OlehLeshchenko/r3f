import{a9 as y,aa as p,ab as g,K as P,i as v,s as X,q as d,a6 as S,n as T,a7 as b,p as M,R as N,Y as C}from"./index-DAa9yKAB.js";import{T as H}from"./THistPainter-DJAmNO-k.js";import{T as w}from"./TH1Painter-C7yoCsum.js";import{p as _,_ as O}from"./func-CztLwFD8.js";import"./TPavePainter-DMWA3hUD.js";function z(f,e,t,i){let a,n;i>0?(n=Math.log(i),a=t>0?Math.log(t):n-5):(n=-10,a=-15),f.fNbins=e,f.fXbins=new Array(e+1);for(let s=0;s<=e;++s)f.fXbins[s]=Math.exp(a+s/e*(n-a));f.fXmin=Math.exp(a),f.fXmax=Math.exp(n)}function A(f){C(f)||(f="");let e=f.indexOf(";webcanv_hist"),t=!1,i=0;return e>=0&&(t=!0,f=f.slice(0,e)),e=f.indexOf(";force_saved"),e>=0&&(i=2,f=f.slice(0,e)),e=f.indexOf(";prefer_saved"),e>=0&&(i=1,f=f.slice(0,e)),{opt:f,_webcanv_hist:t,_use_saved:i}}class F extends w{#t;#e;#i;#s;setFunc(e){this.#e=e}getObjectName(){return this.#e?.fName??"func"}getClassName(){return this.#e?._typename??y}isTF1(){return!0}isTF12(){return this.getClassName()===p}getPrimaryObject(){return this.#e}updateObject(e){if(!e||this.getClassName()!==e._typename)return!1;delete e.evalPar;const t=this.getHisto();if(this._webcanv_hist){const i=this.getPadPainter()?.findInPrimitives("Func",g);i&&this.updateAxes(t,i,this.getFramePainter())}return this.setFunc(e),this.createTF1Histogram(e,t),this.scanContent(),!0}redraw(e){return!this.#t&&(e==="logx"||e==="zoom")&&(this.createTF1Histogram(this.#e,this.getHisto()),this.scanContent()),super.redraw(e)}createTF1Histogram(e,t){const i=this.getFramePainter(),a=this.getPadPainter()?.getRootPad(!0),n=a?.fLogx,s=i?.getGrFuncs(this.second_x,this.second_y);let o=e.fXmin,c=e.fXmax,m=Math.max(e.fNpx,100);if(s?.zoom_xmin!==s?.zoom_xmax){const l=(c-o)/m;o<s.zoom_xmin&&s.zoom_xmin<c&&(o=Math.max(o,s.zoom_xmin-l)),o<s.zoom_xmax&&s.zoom_xmax<c&&(c=Math.min(c,s.zoom_xmax+l))}this.#t=e.fSave.length>3&&(P.PreferSavedPoints||this._use_saved>1);const h=l=>{t.fNcells!==l+2&&(t.fNcells=l+2,t.fArray=new Float32Array(t.fNcells)),t.fArray.fill(0),t.fXaxis.fNbins=l,t.fXaxis.fXbins=[]};if(this.#s=void 0,!this.#t){let l=!1;if(!e.evalPar)try{this.isTF12()?_(e.fF2)?e.evalPar=function(r){return this.fCase?this.fF2.evalPar(r,this.fXY):this.fF2.evalPar(this.fXY,r)}:l=!0:_(e)||(l=!0)}catch{l=!0}h(m),n?z(t.fXaxis,m,o,c):(t.fXaxis.fXmin=o,t.fXaxis.fXmax=c);for(let r=0;r<m&&!l;r++){const x=t.fXaxis.GetBinCenter(r+1);let u=0;try{u=e.evalPar(x)}catch{l=!0}l||t.setBinContent(r+1,Number.isFinite(u)?u:0)}l&&(this.#s=!0),l&&e.fSave.length>3&&(this.#t=!0)}if(this.#t){m=e.fSave.length-3;let l=null;if(o=e.fSave[m+1],c=e.fSave[m+2],o===c){const r=this.getMainPainter();v(r?.getHisto)&&(l=r?.getHisto()?.fXaxis)}if(l){h(t.fXaxis.fNbins),Object.assign(t.fXaxis,l);for(let r=0;r<m;++r){const x=e.fSave[r];t.setBinContent(r+1,Number.isFinite(x)?x:0)}}else{h(e.fNpx),t.fXaxis.fXmin=e.fXmin,t.fXaxis.fXmax=e.fXmax;for(let r=0;r<e.fNpx;++r){const x=O(e,t.fXaxis.GetBinCenter(r+1));t.setBinContent(r+1,Number.isFinite(x)?x:0)}}}t.fName="Func",X(t,e.fTitle),t.fMinimum=e.fMinimum,t.fMaximum=e.fMaximum,t.fLineColor=e.fLineColor,t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,t.fFillColor=e.fFillColor,t.fFillStyle=e.fFillStyle,t.fMarkerColor=e.fMarkerColor,t.fMarkerStyle=e.fMarkerStyle,t.fMarkerSize=e.fMarkerSize,t.fBits|=d}extractAxesProperties(e){super.extractAxesProperties(e);const t=this.#e,i=t?.fSave.length??0;i>3&&this.#t&&(this.xmin=Math.min(this.xmin,t.fSave[i-2]),this.xmax=Math.max(this.xmax,t.fSave[i-1])),t&&(this.xmin=Math.min(this.xmin,t.fXmin),this.xmax=Math.max(this.xmax,t.fXmax))}canZoomInside(e,t,i){const a=this.#e?.fSave.length??0;if(a>3&&this.#t&&e==="x"){const n=a-2,s=this.#e.fSave[a-2],o=this.#e.fSave[a-1];return Math.abs(o-s)/n<Math.abs(i-t)}return e==="x"||e==="y"}getTF1Tooltips(e){this.#i=void 0;const t=[this.getObjectHint()],i=this.getOptions(),a=this.getFramePainter()?.getGrFuncs(i.second_x,i.second_y);if(!a||!v(this.#e?.evalPar))return t.push("grx = "+e.x,"gry = "+e.y),t;const n=a.revertAxis("x",e.x);let s=0,o=0,c=!1;try{s=this.#e.evalPar(n),o=Math.round(a.gry(s))}catch{c=!0}return t.push("x = "+a.axisAsText("x",n),"value = "+(c?"<fail>":S(s,T.fStatFormat))),c||(this.#i={y:s,gry:o}),t}processTooltipEvent(e){if(this.#t)return super.processTooltipEvent(e);let t=this.getG()?.selectChild(".tooltip_bin");if(!this.getG()||!e)return t?.remove(),null;const i={name:this.#e?.fName,title:this.#e?.fTitle,x:e.x,y:e.y,color1:this.lineatt?.color??"green",color2:this.fillatt?.getFillColorAlt("blue")??"blue",lines:this.getTF1Tooltips(e),exact:!0,menu:!0};return e.disabled?t.remove():(t.empty()&&(t=this.getG().append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").style("fill","none").attr("r",(this.lineatt?.width??1)+4)),t.attr("cx",e.x).attr("cy",this.#i?.gry??e.y),this.lineatt&&t.call(this.lineatt.func)),i}fillWebObjectOptions(e){e.fcust=this.#s&&!this._use_saved?"func_fail":""}static async draw(e,t,i){const a=A(i);i=a.opt,delete a.opt;let n;a._webcanv_hist&&(n=b(e)?.findInPrimitives("Func",g)),n||(n=M(g,100),n.fBits|=d),!i&&N(e)&&(i="same");const s=new F(e,n);return s.setFunc(t),Object.assign(s,a),s.createTF1Histogram(t,n),H._drawHist(s,i)}}export{F as TF1Painter,z as produceTAxisLogScale,A as scanTF1Options};
