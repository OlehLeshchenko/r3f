import{i as j,bT as V,bH as B,m as L,aH as W,am as w,K as F,bO as K,bp as N,N as H}from"./index-DAa9yKAB.js";import{RObjectPainter as X,ensureRCanvas as q}from"./RCanvasPainter-BGRtT7_9.js";function Q(){const g=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(g.fPos,i),h=this.v7EvalFont("text",{size:12,color:"black",align:22});return this.createG(n?"main_layer":i?"upper_layer":!1),this.startTextDrawingAsync(h,"font").then(()=>(this.drawText({x:t.x,y:t.y,text:g.fText,latex:1}),this.finishTextDrawing()))}function U(){const g=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(g.fP1,i),h=e.getCoordinate(g.fP2,i),f=this.createG(n?"main_layer":i?"upper_layer":!1);this.createv7AttLine(),f.append("svg:path").attr("d",`M${t.x},${t.y}L${h.x},${h.y}`).call(this.lineatt.func)}function Y(){const g=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(g.fP1,i),h=e.getCoordinate(g.fP2,i),f=this.createG(n?"main_layer":i?"upper_layer":!1);this.createv7AttLine("border_"),this.createv7AttFill(),f.append("svg:path").attr("d",`M${t.x},${t.y}H${h.x}V${h.y}H${t.x}Z`).call(this.lineatt.func).call(this.fillatt.func)}function tt(){const g=this.getObject(),e=this.getPadPainter(),i=this.v7EvalAttr("onFrame",!1)?e.getFramePainter():null,n=i?this.v7EvalAttr("clipping",!1):!1,t=e.getCoordinate(g.fP,i),h=this.createG(n?"main_layer":i?"upper_layer":!1);this.createv7AttMarker();const f=this.markeratt.create(t.x,t.y);f&&h.append("svg:path").attr("d",f).call(this.markeratt.func)}class T extends X{getHistPalette(){const e=this.getObject()?.fPalette;return e&&!j(e.getColor)&&V(e,`${B}RPalette`),e}drawPalette(e){const i=this.getHistPalette(),n=i.getContour(),t=this.getFramePainter();if(!n)return console.log("no contour - no palette");if(!t)return console.log("no frame painter - no palette");const h=n.at(0),f=n.at(-1),p=t.getFrameRect(),P=this.getPadPainter().getPadWidth(),k=this.getPadPainter().getPadHeight(),D=this.v7EvalAttr("visible",!0),s=this.v7EvalAttr("vertical",!0),b=this.getG();let M=i.full_min,A=i.full_max,C,$,l,c;if(e){l=e.width,c=e.height;const a={};s?(this.v7AttrChange(a,"margin",(e.x-p.x-p.width)/P),this.v7AttrChange(a,"width",l/P)):(this.v7AttrChange(a,"margin",(e.y-p.y-p.height)/P),this.v7AttrChange(a,"width",c/k)),this.v7SendAttrChanges(a,!1)}else{if(s){const a=this.v7EvalLength("margin",P,.02);C=Math.round(p.x+p.width+a),l=this.v7EvalLength("width",P,.05),$=p.y,c=p.height}else{const a=this.v7EvalLength("margin",k,.02);C=p.x,l=p.width,$=Math.round(p.y+p.height+a),c=this.v7EvalLength("width",k,.05)}L(b,C,$)}let z=b.selectChild(".colbtns");if(z.empty()?z=b.append("svg:g").attr("class","colbtns"):z.selectAll("*").remove(),!D)return;z.append("svg:path").attr("d",`M0,0H${l}V${c}H0Z`).style("stroke","black").style("fill","none"),(M===void 0||A===void 0)&&(M=h,A=f),s?t.z_handle.configureAxis("zaxis",M,A,h,f,!0,[c,0],-c,{reverse:!1}):t.z_handle.configureAxis("zaxis",M,A,h,f,!1,[0,l],l,{reverse:!1});for(let a=0;a<n.length-1;++a){const m=Math.round(t.z_handle.gr(n[a])),u=Math.round(t.z_handle.gr(n[a+1])),d=i.getContourColor((n[a]+n[a+1])/2),x=z.append("svg:path").attr("d",s?`M0,${u}H${l}V${m}H0Z`:`M${m},0V${c}H${u}V0Z`).style("fill",d).style("stroke",d).property("fill0",d).property("fill1",W(d).darker(.5).formatRgb());this.isBatchMode()||(this.isTooltipAllowed()&&x.on("mouseover",function(){w(this).transition().duration(100).style("fill",w(this).property("fill1"))}).on("mouseout",function(){w(this).transition().duration(100).style("fill",w(this).property("fill0"))}).append("svg:title").text(n[a].toFixed(2)+" - "+n[a+1].toFixed(2)),F.Zooming&&x.on("dblclick",()=>t.unzoom("z")))}t.z_handle.maxTickSize=Math.round(l*.3);const R=t.z_handle.drawAxis(b,L(s?l:0,c),s?-1:1);return this.isBatchMode()||e?R:R.then(()=>{if(F.ContextMenu&&b.on("contextmenu",r=>{r.stopPropagation(),r.preventDefault(),K(r,this).then(o=>{o.header("Palette"),o.addchk(s,"Vertical",y=>{this.v7SetAttr("vertical",y),this.redrawPad()}),t.z_handle.fillAxisContextMenu(o,"z"),o.show()})}),N(this,{x:C,y:$,width:l,height:c,minwidth:20,minheight:20,no_change_x:!s,no_change_y:s,redraw:r=>this.drawPalette(r)}),!F.Zooming)return;let a=!1,m=0,u=0,d,x,E,v;const S=r=>{if(!a)return;if(r.preventDefault(),v=H(r,this.getG().node()),E)return t.z_handle.processLabelsMove("move",v);s?u=Math.min(Math.max(v[1],0),c):u=Math.min(Math.max(v[0],0),l);const o=Math.abs(u-m);!x&&o>1&&(d.style("display",null),x=!0),s?d.attr("y",Math.min(m,u)).attr("height",o):d.attr("x",Math.min(m,u)).attr("width",o)},O=r=>{if(a)if(r.preventDefault(),w(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null),d.remove(),d=null,a=!1,E)t.z_handle.processLabelsMove("stop",v);else{const o=t.z_handle.func,y=o.invert(m),_=o.invert(u);t.zoomSingle("z",Math.min(y,_),Math.max(y,_))}},Z=r=>{a||(a=!0,r.preventDefault(),r.stopPropagation(),v=H(r,this.getG().node()),m=u=v[s?1:0],x=!1,E=!1,d=z.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").style("display","none"),s?d.attr("x",0).attr("width",l).attr("y",m).attr("height",1):d.attr("x",m).attr("width",1).attr("y",0).attr("height",c),w(window).on("mousemove.colzoomRect",S).on("mouseup.colzoomRect",O,!0),setTimeout(()=>{!x&&a&&(E=t.z_handle.processLabelsMove("start",v))},500))},G=()=>{this.getG().selectAll(".axis_zoom, .axis_labels").on("mousedown",Z).on("dblclick",()=>t.unzoom("z")),F.ZoomWheel&&this.getG().on("wheel",r=>{r.stopPropagation(),r.preventDefault();const o=H(r,this.getG().node()),y=s?1-o[1]/c:o[0]/l,_=t.z_handle.analyzeWheelEvent(r,y);_.changed&&t.zoomSingle("z",_.min,_.max)})};t.z_handle.setAfterDrawHandler(G),G()})}static async draw(e,i,n){const t=new T(e,i,n,"palette");return q(t).then(()=>(t.createG(),t))}}export{T as RPalettePainter,Y as drawBox,U as drawLine,tt as drawMarker,Q as drawText};
