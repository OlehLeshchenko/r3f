import{O as o,y as f,D as c,z as m,A as n}from"./index-DAa9yKAB.js";import{T as u}from"./TH1Painter-C7yoCsum.js";import"./THistPainter-DJAmNO-k.js";import"./TPavePainter-DMWA3hUD.js";import"./func-CztLwFD8.js";class h extends o{#t;#i;#r;#e;constructor(e,t,i){super(e,t,i),this.decodeOptions(i),this.#i="grtime_"+f.id_counter++}redraw(){this.#t===void 0&&this.startDrawing()}decodeOptions(e){const t=new c(e||"REPEAT");this.setOptions({once:t.check("ONCE"),repeat:t.check("REPEAT"),first:t.check("FIRST")}),this.storeDrawOpt(e)}async drawPrimitives(e){const t=this.getObject()?.fSteps.arr[this.#t];if(!t||e>=t.arr.length)return;const i=t.arr[e],r=t.opt[e]+(i._typename===m?";no_interactive":"");return n(this.getPadPainter(),i,r).then(s=>(s&&(s.$grtimeid=this.#i,s.$grstep=this.#t),this.drawPrimitives(e+1)))}continueDrawing(){const e=this.getObject(),t=this.getOptions();if(t.first){this.#t=void 0;return}if(this.#r){this.#r=void 0;const i=this.getPadPainter();if(!i){this.#t=void 0;return}this.drawPrimitives(0).then(()=>{i.cleanPrimitives(r=>r.$grtimeid===this.#i&&r.$grstep!==this.#t),this.continueDrawing()})}else if(this.#e)clearTimeout(this.#e),this.#e=void 0,this.#r=!0,requestAnimationFrame(()=>this.continueDrawing());else{let i=Math.max(e.fSleepTime,10);if(++this.#t>e.fSteps.arr.length)if(t.repeat)this.#t=0,i=Math.max(5e3,5*i);else{this.#t=void 0;return}this.#e=setTimeout(()=>this.continueDrawing(),i)}}startDrawing(){return this.#t=0,this.drawPrimitives(0).then(()=>(this.continueDrawing(),this))}static async draw(e,t,i){if(!t.fFrame)return console.error("Frame histogram not exists"),null;const r=new h(e,t,i);if(r.getMainPainter())return console.error("Cannot draw graph time on top of other histograms"),null;if(!t.fFrame.fTitle&&t.fTitle){const s=t.fTitle.split(";");t.fFrame.fTitle=s[0],s[1]&&(t.fFrame.fXaxis.fTitle=s[1]),s[2]&&(t.fFrame.fYaxis.fTitle=s[2])}return u.draw(e,t.fFrame,"").then(()=>(r.addToPadPrimitives(),r.startDrawing()))}}async function P(a,e){return n(a,e._hist,"hist").then(async t=>{const i=[];for(let r=0;r<e._items.arr.length;++r)i.push(n(a,e._items.arr[r],e._items.opt[r]));return Promise.all(i).then(()=>t)})}export{h as TGraphTimePainter,P as drawRooPlot};
