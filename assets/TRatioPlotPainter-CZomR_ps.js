import{O as C,$ as h,i as F,j as X,a0 as G,e as y}from"./index-DAa9yKAB.js";import{TLinePainter as b}from"./TLinePainter-DxUXHIIJ.js";const T="upper_pad",g="lower_pad",k="top_pad";class x extends C{#e;setGridsRange(i,r,n,t,f){const a=this.getObject();if(i===r){const e=this.getPadPainter()?.findPainterFor(a.fLowerPad,g,h)?.getFramePainter()?.x_handle;if(!e)return;i===0?(i=e.full_min,r=e.full_max):(i=e.scale_min,r=e.scale_max)}a.fGridlines.forEach(e=>{e.fX1=i,e.fX2=r});const o=Math.min(a.fGridlines.length,a.fGridlinePositions.length);for(let e=0;e<o;++e){const d=a.fGridlinePositions[e],s=a.fGridlines[e];n!=="ignorey"&&(s.$do_not_draw=n!==t&&(d<n||d>t),s.fY1=s.fY2=d),f?.findPainterFor(s)?.redraw()}}configureInteractive(){const i=this.getObject(),r=this.getPadPainter(),n=r.findPainterFor(i.fUpperPad,T,h),t=n?.getFramePainter(),f=r.findPainterFor(i.fLowerPad,g,h),a=f?.getFramePainter();!n||!f||(f.forEachPainterInPad(o=>{F(o?.testEditable)&&o.testEditable(!1)}),this.setGridsRange(a.scale_xmin,a.scale_xmax,a.scale_ymin,a.scale_ymax,f),!(n._ratio_interactive&&f._ratio_interactive)&&(n._ratio_interactive=!0,f._ratio_interactive=!0,t.o_zoom=t.zoom,t._ratio_low_fp=a,t._ratio_painter=this,t.zoom=function(o,e,d,s,_,l){return this.o_zoom(o,e,d,s,_,l).then(u=>(this._ratio_painter.setGridsRange(t.scale_xmin,t.scale_xmax,"ignory"),this._ratio_low_fp.o_zoom(t.scale_xmin,t.scale_xmax).then(()=>u)))},t.o_sizeChanged=t.sizeChanged,t.sizeChanged=function(){this.o_sizeChanged(),this._ratio_low_fp.fX1NDC=this.fX1NDC,this._ratio_low_fp.fX2NDC=this.fX2NDC,this._ratio_low_fp.o_sizeChanged()},a.o_zoom=a.zoom,a._ratio_up_fp=t,a._ratio_painter=this,a.zoom=function(o,e,d,s,_,l){return o===e?(o=t.xmin,e=t.xmax):(o=Math.min(o,t.xmin),e=Math.max(e,t.xmax)),this._ratio_painter.setGridsRange(o,e,d,s),this._ratio_up_fp.o_zoom(o,e).then(()=>this.o_zoom(o,e,d,s,_,l))},a.o_sizeChanged=a.sizeChanged,a.sizeChanged=function(){this.o_sizeChanged(),this._ratio_up_fp.fX1NDC=this.fX1NDC,this._ratio_up_fp.fX2NDC=this.fX2NDC,this._ratio_up_fp.o_sizeChanged()}))}async redrawOld(){const i=this.getObject(),r=this.getPadPainter(),n=r.findPainterFor(i.fTopPad,k,h),t=r.getRootPad(),f=t.fFrameFillStyle===0?1:0,a=t.fTickx||f,o=t.fTicky||f;n?.disablePadDrawing();const e=r.findPainterFor(i.fUpperPad,T,h),d=e?.getMainPainter(),s=e?.getFramePainter(),_=r.findPainterFor(i.fLowerPad,g,h),l=_?.getMainPainter(),u=_?.getFramePainter();let w=Promise.resolve(!0);if(e&&d&&s&&u&&!e._ratio_configured){e._ratio_configured=!0,d.options.Axis=0;const c=d.getHisto();c.fYaxis.$use_top_pad=!0,c.fXaxis.fLabelSize=0,c.fXaxis.fTitle="",e.getRootPad().fTickx=a,e.getRootPad().fTicky=o,w=e.redrawPad()}return w.then(()=>{if(!_||!l||!u||!s||_._ratio_configured)return this;_._ratio_configured=!0,l.options.Axis=0;const c=l.getHisto();c.fXaxis.fTitle="x",c.fXaxis.$use_top_pad=!0,c.fYaxis.$use_top_pad=!0,_.getRootPad().fTickx=a,_.getRootPad().fTicky=o;const m=[];return i.fGridlinePositions.length&&i.fGridlines.length<i.fGridlinePositions.length&&i.fGridlinePositions.forEach(P=>{let z=!1;if(i.fGridlines.forEach(p=>{p.fY1===p.fY2&&Math.abs(p.fY1-P)<1e-6&&(z=!0)}),!z){const p=X(G);p.fX1=s.scale_xmin,p.fX2=s.scale_xmax,p.fY1=p.fY2=P,p.fLineStyle=2,i.fGridlines.push(p),m.push(b.draw(_,p))}}),Promise.all(m).then(()=>u.zoomSingle("x",s.scale_xmin,s.scale_xmax)).then(P=>P?!0:_.redrawPad()).then(()=>this)})}async redraw(){const i=this.getObject(),r=this.getPadPainter();if(this.#e===void 0&&(this.#e=!!r.findPainterFor(i.fTopPad,k,h)),r.$userInteractive=()=>this.configureInteractive(),this.#e)return this.redrawOld();const n=r.getRootPad(),t=n.fFrameFillStyle===0?1:0,f=n.fTickx||t,a=n.fTicky||t;return i.fTopPad.$disable_drawing=!0,i.fUpperPad.$ratio_pad="up",i.fUpperPad.fTickx=f,i.fUpperPad.fTicky=a,i.fLowerPad.$ratio_pad="low",i.fLowerPad.fTickx=f,i.fLowerPad.fTicky=a,this}static async draw(i,r,n){const t=new x(i,r,n);return y(t,!1).then(()=>t.redraw())}}export{x as TRatioPlotPainter};
