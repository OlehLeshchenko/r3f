import{a8 as C,t as X,K as k,s as Y,q as T,D as B,a7 as L,p as O}from"./index-DAa9yKAB.js";import{TH2Painter as Z}from"./TH2Painter-yQJYXbd3.js";import{p as j}from"./func-CztLwFD8.js";import{produceTAxisLogScale as A,scanTF1Options as E}from"./TF1Painter-CSSx4PF-.js";import{T as G}from"./THistPainter-DJAmNO-k.js";import"./hist3d-BC5Tno_J.js";import"./latex3d-BISPawP1.js";import"./TH2Painter-Ba0oelVz.js";import"./TH1Painter-C7yoCsum.js";import"./TPavePainter-DMWA3hUD.js";function H(F,e,t=0){for(let i=F.length-2;i>=0;--i){const n=e[i],f=e[i+1],s=F[i],x=F[i+1];if(n===t)return s;if(f===t)return x;if(n<t!=f<t)return s+(t-n)/(f-n)*(x-s)}return F[0]-1}class b extends Z{#t;#e;#i;setFunc(e){this.#e=e}getObjectName(){return this.#e?.fName??"func"}getClassName(){return this.#e?._typename??C}isTF1(){return!0}getPrimaryObject(){return this.#e}updateObject(e){if(!e||this.getClassName()!==e._typename)return!1;delete e.evalPar;const t=this.getHisto();if(this._webcanv_hist){const i=this.getPadPainter()?.findInPrimitives("Func",X);i&&this.updateAxes(t,i,this.getFramePainter())}return this.setFunc(e),this.createTF3Histogram(e,t),this.scanContent(),!0}redraw(e){return!this.#t&&(e==="logx"||e==="logy"||e==="logy"||e==="zoom")&&(this.createTF3Histogram(this.#e,this.getHisto()),this.scanContent()),super.redraw(e)}createTF3Histogram(e,t){const i=e.fSave.length-9;this.#t=i>0&&(k.PreferSavedPoints||this._use_saved>1);const n=this.getFramePainter(),f=this.getPadPainter()?.getRootPad(!0),s=f?.fLogx,x=f?.fLogy,a=n?.getGrFuncs(this.second_x,this.second_y);let y=e.fXmin,_=e.fXmax,v=e.fYmin,g=e.fYmax,l=e.fZmin,M=e.fZmax,d=Math.max(e.fNpx,20),p=Math.max(e.fNpy,20),o=Math.max(e.fNpz,20);if(a?.zoom_xmin!==a?.zoom_xmax){const m=(_-y)/d;y<a.zoom_xmin&&a.zoom_xmin<_&&(y=Math.max(y,a.zoom_xmin-m)),y<a.zoom_xmax&&a.zoom_xmax<_&&(_=Math.min(_,a.zoom_xmax+m))}if(a?.zoom_ymin!==a?.zoom_ymax){const m=(g-v)/p;v<a.zoom_ymin&&a.zoom_ymin<g&&(v=Math.max(v,a.zoom_ymin-m)),v<a.zoom_ymax&&a.zoom_ymax<g&&(g=Math.min(g,a.zoom_ymax+m))}a?.zoom_zmin!==a?.zoom_zmax&&(l<a.zoom_zmin&&a.zoom_zmin<M&&(l=a.zoom_zmin),l<a.zoom_zmax&&a.zoom_zmax<M&&(M=a.zoom_zmax));const w=(m,h)=>{t.fNcells!==(m+2)*(h+2)&&(t.fNcells=(m+2)*(h+2),t.fArray=new Float32Array(t.fNcells)),t.fArray.fill(0),t.fXaxis.fNbins=m,t.fXaxis.fXbins=[],t.fYaxis.fNbins=h,t.fYaxis.fXbins=[],t.fXaxis.fXmin=y,t.fXaxis.fXmax=_,t.fYaxis.fXmin=v,t.fYaxis.fXmax=g,t.fMinimum=l,t.fMaximum=M};if(this.#i=void 0,!this.#t){let m=!1;!e.evalPar&&!j(e)&&(m=!0),w(d,p),s&&A(t.fXaxis,d,y,_),x&&A(t.fYaxis,p,v,g);const h=new Array(o),S=new Array(o);for(let r=0;r<o;++r)S[r]=l+r/(o-1)*(M-l);for(let r=0;r<p&&!m;++r)for(let z=0;z<d&&!m;++z){const u=t.fXaxis.GetBinCenter(z+1),c=t.fYaxis.GetBinCenter(r+1);let N=0;try{for(let P=0;P<o;++P)h[P]=e.evalPar(u,c,S[P]);N=H(S,h)}catch{m=!0}m||t.setBinContent(t.getBin(z+1,r+1),Number.isFinite(N)?N:0)}m&&(this.#i=!0),m&&i>0&&(this.#t=!0)}if(this.#t){y=e.fSave[i],_=e.fSave[i+1],v=e.fSave[i+2],g=e.fSave[i+3],l=e.fSave[i+4],M=e.fSave[i+5],d=Math.round(e.fSave[i+6]),p=Math.round(e.fSave[i+7]),o=Math.round(e.fSave[i+8]);const m=(M-l)/o;w(d+1,p+1);const h=new Array(o+1),S=new Array(o+1);for(let r=0;r<=o;r++)S[r]=l+r*m;for(let r=0;r<=d;++r)for(let z=0;z<=p;++z){for(let c=0;c<=o;c++)h[c]=e.fSave[r+(d+1)*(z+(p+1)*c)];const u=H(S,h);t.setBinContent(t.getBin(r+1,z+1),Number.isFinite(u)?u:0)}}return t.fName="Func",Y(t,e.fTitle),t.fLineColor=e.fLineColor,t.fLineStyle=e.fLineStyle,t.fLineWidth=e.fLineWidth,t.fFillColor=e.fFillColor,t.fFillStyle=e.fFillStyle,t.fMarkerColor=e.fMarkerColor,t.fMarkerStyle=e.fMarkerStyle,t.fMarkerSize=e.fMarkerSize,t.fBits|=T,t}extractAxesProperties(e){super.extractAxesProperties(e);const t=this.#e,i=t?.fSave.length??0;i>9&&this.#t&&(this.xmin=Math.min(this.xmin,t.fSave[i-9]),this.xmax=Math.max(this.xmax,t.fSave[i-8]),this.ymin=Math.min(this.ymin,t.fSave[i-7]),this.ymax=Math.max(this.ymax,t.fSave[i-6]),this.zmin=Math.min(this.zmin,t.fSave[i-5]),this.zmax=Math.max(this.zmax,t.fSave[i-4])),t&&(this.xmin=Math.min(this.xmin,t.fXmin),this.xmax=Math.max(this.xmax,t.fXmax),this.ymin=Math.min(this.ymin,t.fYmin),this.ymax=Math.max(this.ymax,t.fYmax),this.zmin=Math.min(this.zmin,t.fZmin),this.zmax=Math.max(this.zmax,t.fZmax))}fillWebObjectOptions(e){e.fcust=this.#i&&!this._use_saved?"func_fail":""}static async draw(e,t,i){const n=E(i);i=n.opt,delete n.opt;const f=new B(i);f.empty()||i==="gl"?i="surf1":f.opt==="SAME"&&(i="surf1 same");let s;n._webcanv_hist&&(s=L(e)?.findInPrimitives("Func",X)),s||(s=O(X,20,20),s.fBits|=T);const x=new b(e,s);return x.setFunc(t,C),Object.assign(x,n),x.createTF3Histogram(t,s),G._drawHist(x,i)}}export{b as TF3Painter};
