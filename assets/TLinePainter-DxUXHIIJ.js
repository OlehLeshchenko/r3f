import{O as c,B as f,D as o,b as d,a as y,e as u}from"./index-DAa9yKAB.js";const r=f(14);class x extends c{#t;moveStart(t,s){const i=Math.max(1,Math.sqrt((this.x1-this.x2)**2+(this.y1-this.y2)**2)),e=Math.sqrt((t-this.x1)**2+(s-this.y1)**2)/i,h=Math.sqrt((t-this.x2)**2+(s-this.y2)**2)/i;e>.9?this.#t=1:h>.9?this.#t=-1:this.#t=0}moveDrag(t,s){this.#t!==1&&(this.x1+=t,this.y1+=s),this.#t!==-1&&(this.x2+=t,this.y2+=s),this.getG().select("path").attr("d",this.createPath())}moveEnd(t){if(t)return;const s=this.getObject();let i="",e=this.svgToAxis("x",this.x1,this.isndc),h=this.svgToAxis("x",this.x2,this.isndc),a=this.svgToAxis("y",this.y1,this.isndc),n=this.svgToAxis("y",this.y2,this.isndc);this.swap_xy&&([e,a,h,n]=[a,e,n,h]),s.fX1=e,s.fX2=h,s.fY1=a,s.fY2=n,this.#t!==1&&(i+=`SetX1(${e});;SetY1(${a});;`),this.#t!==-1&&(i+=`SetX2(${h});;SetY2(${n});;`),this.submitCanvExec(i+"Notify();;")}getUserRanges(){const t=this.getObject();if(t.TestBit(r))return null;const i=Math.min(t.fX1,t.fX2),e=Math.max(t.fX1,t.fX2),h=Math.min(t.fY1,t.fY2),a=Math.max(t.fY1,t.fY2);return{minx:i,miny:h,maxx:e,maxy:a}}prepareDraw(){const t=this.getObject();this.isndc=t.TestBit(r);const s=this.isndc?!1:new o(this.getDrawOpt()).check("FRAME");this.createG(s?"frame2d":void 0),this.swap_xy=s&&this.getFramePainter()?.swap_xy();const i=this.getAxisToSvgFunc(this.isndc,!0);this.x1=i.x(t.fX1),this.y1=i.y(t.fY1),this.x2=i.x(t.fX2),this.y2=i.y(t.fY2),this.swap_xy&&([this.x1,this.y1,this.x2,this.y2]=[this.y1,this.x1,this.y2,this.x2]),this.createAttLine({attr:t})}createPath(){const t=Math.round(this.x1),s=Math.round(this.x2),i=Math.round(this.y1),e=Math.round(this.y2);return`M${t},${i}`+(t===s?`V${e}`:i===e?`H${s}`:`L${s},${e}`)}addExtras(){}redraw(){this.prepareDraw();const t=this.appendPath(this.createPath()).call(this.lineatt.func);return this.getObject()?.$do_not_draw?t.remove():(this.addExtras(t),d(this),y(this)),this}static async draw(t,s,i){const e=new x(t,s,i);return u(e,!1).then(()=>e.redraw())}}export{x as TLinePainter};
