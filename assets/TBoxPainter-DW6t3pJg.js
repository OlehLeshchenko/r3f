import{O as n,am as o,b6 as x,D as f,aH as c,a as l,b as y,e as _}from"./index-DAa9yKAB.js";class r extends n{#t;#s;moveStart(t,s){const i=Math.abs(this.x2-this.x1),h=Math.abs(this.y1-this.y2);this.c_x1=Math.abs(t-this.x2)>i*.1,this.c_x2=Math.abs(t-this.x1)>i*.1,this.c_y1=Math.abs(s-this.y2)>h*.1,this.c_y2=Math.abs(s-this.y1)>h*.1,this.c_x1!==this.c_x2&&this.c_y1&&this.c_y2&&(this.c_y1=this.c_y2=!1),this.c_y1!==this.c_y2&&this.c_x1&&this.c_x2&&(this.c_x1=this.c_x2=!1)}moveDrag(t,s){this.x1+=this.c_x1?t:0,this.x2+=this.c_x2?t:0,this.y1+=this.c_y1?s:0,this.y2+=this.c_y2?s:0;const i=this.getG().selectAll("path").nodes();this.getPathes().forEach((e,a)=>o(i[a]).attr("d",e))}moveEnd(t){if(t)return;const s=this.getObject(),i=this.swap_xy?"Y":"X",h=this.swap_xy?"X":"Y";let e="";if(this.c_x1){const a=this.svgToAxis("x",this.x1);s[`f${i}1`]=a,e+=`Set${i}1(${a});;`}if(this.c_x2){const a=this.svgToAxis("x",this.x2);s[`f${i}2`]=a,e+=`Set${i}2(${a});;`}if(this.c_y1){const a=this.svgToAxis("y",this.y1);s[`f${h}1`]=a,e+=`Set${h}1(${a});;`}if(this.c_y2){const a=this.svgToAxis("y",this.y2);s[`f${h}2`]=a,e+=`Set${h}2(${a});;`}this.submitCanvExec(e+"Notify();;")}getUserRanges(){const t=this.getObject(),s=Math.min(t.fX1,t.fX2),i=Math.max(t.fX1,t.fX2),h=Math.min(t.fY1,t.fY2),e=Math.max(t.fY1,t.fY2);return{minx:s,miny:h,maxx:i,maxy:e}}getPathes(){const t=Math.round(Math.min(this.x1,this.x2)),s=Math.round(Math.min(this.y1,this.y2)),i=Math.round(Math.abs(this.x2-this.x1)),h=Math.round(Math.abs(this.y1-this.y2)),e=`M${t},${s}h${i}v${h}h${-i}z`;return this.#t?[e].concat(x(t,s,i,h,this.#t,this.#s,this.#s)):[e]}redraw(){const t=this.getObject(),s=new f(this.getDrawOpt()),i=s.check("FRAME")?this.getFramePainter():null,h=s.check("L");this.createAttLine({attr:t}),this.createAttFill({attr:t}),this.swap_xy=i?.swap_xy(),!this.fillatt.empty()&&!h&&(this.lineatt.color="none");const e=this.createG(i);this.x1=this.axisToSvg("x",t.fX1),this.x2=this.axisToSvg("x",t.fX2),this.y1=this.axisToSvg("y",t.fY1),this.y2=this.axisToSvg("y",t.fY2),this.swap_xy&&([this.x1,this.x2,this.y1,this.y2]=[this.y1,this.y2,this.x1,this.x2]),this.#t=t.fBorderMode&&this.fillatt.hasColor()?t.fBorderMode:0,this.#s=t.fBorderSize||2;const a=this.getPathes();return e.append("svg:path").attr("d",a[0]).call(this.lineatt.func).call(this.fillatt.func),this.#t&&(e.append("svg:path").attr("d",a[1]).call(this.fillatt.func).style("fill",c(this.fillatt.color).brighter(.5).formatRgb()),e.append("svg:path").attr("d",a[2]).call(this.fillatt.func).style("fill",c(this.fillatt.color).darker(.5).formatRgb())),l(this),y(this),this}static async draw(t,s,i){const h=new r(t,s,i);return _(h,!1).then(()=>h.redraw())}}export{r as TBoxPainter};
