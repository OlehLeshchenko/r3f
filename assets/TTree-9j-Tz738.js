import{ad as I,ae as N,af as S,ag as V,ah as E,ai as F,Y as f,O as g,aj as T,ak as L,al as v,am as z,c as b,an as B,ao as H,i as R,y as m,j as M,a2 as C,ap as G,aq as q,I as K,ar as w,as as A,at as x,au as J,W as U,o as W,av as Y,aw as Q,ax as X,ay as Z}from"./index-DAa9yKAB.js";import{TH1Painter as j}from"./TH1Painter-BmkwKNTG.js";import{TH2Painter as ee}from"./TH2Painter-yQJYXbd3.js";import{TH3Painter as y}from"./TH3Painter-BJdKbbIM.js";import{T as re}from"./TGraphPainter-C8qCwVCh.js";import{d as te}from"./TPolyMarker3D-Cx5LiQh7.js";import"./hist3d-BC5Tno_J.js";import"./latex3d-BISPawP1.js";import"./THistPainter-DJAmNO-k.js";import"./TPavePainter-DMWA3hUD.js";import"./TH2Painter-Ba0oelVz.js";import"./TH1Painter-C7yoCsum.js";import"./func-CztLwFD8.js";import"./TGraphPainter-DECA4bpc.js";Z.prototype.ShowProgress=function(i){let t,e;if(i===void 0||!Number.isFinite(i))t=e="";else if(this._break)t="Breaking ... ",e="break";else{if(this.last_progress!==i){const r=i-this.last_progress;this.aver_diff||(this.aver_diff=r),this.aver_diff=r*.3+this.aver_diff*.7}this.last_progress=i;let s=0;this.aver_diff<=0?s=0:this.aver_diff<1e-4?s=3:this.aver_diff<.001?s=2:this.aver_diff<.01&&(s=1),t=`TTree draw ${(i*100).toFixed(s)} % `}return T(t,0,()=>{this._break=1}),e};async function D(i,t,e){const s=t?._typename;return!s||!f(s)?Promise.reject(Error("Object without type cannot be draw with TTree")):s.indexOf(U)===0?j.draw(i,t,e):s.indexOf(W)===0?ee.draw(i,t,e):s.indexOf(Y)===0?y.draw(i,t,e):s.indexOf(Q)===0?re.draw(i,t,e):s===X&&t.$hist?y.draw(i,t.$hist,e).then(()=>{const r=new g(i,t,e);return r.addToPadPrimitives(),r.redraw=te,r.redraw()}):Promise.reject(Error(`Object of type ${s} cannot be draw with TTree`))}async function P(i,t){if(!(!t&&!this.last_pr)){if(this.dump||this.dump_entries||this.testio){if(!t)return;if(H()){const s=new b(this.drawid);return s.selectDom().property("_json_object_",i),s}if(R(m.drawInspector))return m.drawInspector(this.drawid,i);const e=M(C);return e.fString=G(i,2),q(this.drawid,e)}return this.last_pr||(this.last_pr=Promise.resolve(!0)),this.last_pr.then(()=>(this.obj_painter?this.last_pr=K(this.obj_painter.redrawObject(i)).then(()=>this.obj_painter):i?this.last_pr=D(this.drawid,i,this.drawopt).then(e=>(this.obj_painter=e,t||(this.last_pr=null),e)):(t&&console.log("no result after tree drawing"),this.last_pr=!1),t?this.last_pr:null))}}function O(i){return i.draw_first=!0,i.configureOnline=function(t,e,s,r,a){this.setItemName(t,"",this),this.url=e,this.root_version=r,this.askey=s,this.draw_expr=a},i.configureTree=function(t){this.local_tree=t},i.showExtraButtons=function(t){const e=this.selectDom(),s=this.local_tree?.fEntries||0;e.select(".treedraw_more").remove(),e.select(".treedraw_buttons").node().innerHTML+=`Cut: <input class="treedraw_cut ui-corner-all ui-widget" style="width:8em;margin-left:5px" title="cut expression"></input>Opt: <input class="treedraw_opt ui-corner-all ui-widget" style="width:5em;margin-left:5px" title="histogram draw options"></input>Num: <input class="treedraw_number" type='number' min="0" max="${s}" step="1000" style="width:7em;margin-left:5px" title="number of entries to process (default all)"></input>First: <input class="treedraw_first" type='number' min="0" max="${s}" step="1000" style="width:7em;margin-left:5px" title="first entry to process (default first)"></input><button class="treedraw_clear" title="Clear drawing">Clear</button>`,e.select(".treedraw_exe").on("click",()=>this.performDraw()),e.select(".treedraw_cut").property("value",t?.parse_cut||"").on("change",()=>this.performDraw()),e.select(".treedraw_opt").property("value",t?.drawopt||"").on("change",()=>this.performDraw()),e.select(".treedraw_number").attr("value",t?.numentries||""),e.select(".treedraw_first").attr("value",t?.firstentry||""),e.select(".treedraw_clear").on("click",()=>w(this.drawid))},i.showPlayer=function(t){const e=this.selectDom();this.drawid="jsroot_tree_player_"+m.id_counter+++"_draw";const s=t?.parse_cut||t?.numentries||t?.firstentry;e.html(`<div style="display:flex; flex-flow:column; height:100%; width:100%;"><div class="treedraw_buttons" style="flex: 0 1 auto;margin-top:0.2em;"><button class="treedraw_exe" title="Execute draw expression" style="margin-left:0.5em">Draw</button>Expr:<input class="treedraw_varexp treedraw_varexp_info" style="width:12em;margin-left:5px" title="draw expression"></input><label class="treedraw_varexp_info">â“˜</label><button class="treedraw_more">More</button></div><div style="flex: 0 1 auto"><hr/></div><div id="${this.drawid}" style="flex: 1 1 auto; overflow:hidden;"></div></div>`),this.setTopPainter(),this.local_tree&&e.select(".treedraw_buttons").attr("title","Tree draw player for: "+this.local_tree.fName),e.select(".treedraw_exe").on("click",()=>this.performDraw()),e.select(".treedraw_varexp").attr("value",t?.parse_expr||this.draw_expr||"px:py").on("change",()=>this.performDraw()),e.select(".treedraw_varexp_info").attr("title",`Example of valid draw expressions:
  px - 1-dim draw
  px:py - 2-dim draw
  px:py:pz - 3-dim draw
  px+py:px-py - use any expressions
  px:py>>Graph - create and draw TGraph
  px:py>>dump - dump extracted variables
  px:py>>h(50,-5,5,50,-5,5) - custom histogram
  px:py;hbins:100 - custom number of bins`),s?this.showExtraButtons(t):e.select(".treedraw_more").on("click",()=>this.showExtraButtons(t)),this.checkResize(),A(this)},i.getValue=function(t){const e=this.selectDom().select(t);if(!e.empty())return e.property("value")??e.attr("value")},i.performLocalDraw=function(){if(!this.local_tree)return;const t=this.selectDom(),e={expr:this.getValue(".treedraw_varexp")};t.select(".treedraw_more").empty()&&(e.cut=this.getValue(".treedraw_cut"),e.cut||delete e.cut,e.drawopt=this.getValue(".treedraw_opt"),e.drawopt==="dump"&&(e.dump=!0,e.drawopt=""),e.drawopt||delete e.drawopt,e.numentries=parseInt(this.getValue(".treedraw_number")),Number.isInteger(e.numentries)||delete e.numentries,e.firstentry=parseInt(this.getValue(".treedraw_first")),Number.isInteger(e.firstentry)||delete e.firstentry),w(this.drawid),e.drawid=this.drawid,e.progress=P.bind(e),v(this.local_tree,e).then(s=>e.progress(s,!0))},i.getDrawOpt=function(){let t="player";const e=this.getValue(".treedraw_varexp");return e&&(t+=":"+e),t},i.performDraw=function(){if(this.local_tree)return this.performLocalDraw();const t=this.selectDom();let e=this.url+"/exe.json.gz?compact=3&method=Draw",s=this.getValue(".treedraw_varexp"),r="h_tree_draw",a="";const l=s.indexOf(">>");if(l<0)s+=`>>${r}`;else{r=s.slice(l+2),r[0]==="+"&&(r=r.slice(1));const o=r.indexOf("(");o>0&&(r=r.slice(0,o))}if(t.select(".treedraw_more").empty()){const o=this.getValue(".treedraw_cut");let c=this.getValue(".treedraw_number"),d=this.getValue(".treedraw_first");a=this.getValue(".treedraw_opt"),e+=`&prototype="const char*,const char*,Option_t*,Long64_t,Long64_t"&varexp="${s}"&selection="${o}"`,c||(c="TTree::kMaxEntries"),d||(d="0"),e+=`&option="${a}"&nentries=${c}&firstentry=${d}`}else e+=`&prototype="Option_t*"&opt="${s}"`;e+=`&_ret_object_=${r}`;const n=()=>{x(e,"object").then(o=>{w(this.drawid),D(this.drawid,o,a)})};this.draw_expr=s,this.askey?(this.askey=!1,x(this.url+"/root.json.gz?compact=3","text").then(n)):n()},i.checkResize=function(){J(this.drawid)},i}function k(i,t,e,s){let r=i.findItem(t),a="",l=0;const n=i.getTopOnlineItem(r);if(!r||!n)return null;if(s){for(a=r._name;r&&!r._ttree;)r=r._parent;if(!r)return null;t=i.itemFullName(r)}const o=i.getOnlineItemUrl(t);if(!o)return null;const c=n._root_version||400129,d=i.getDisplay();if(!d)return null;const _=d.findFrame(t,!0);if(!_)return null;const $=z(_).attr("id"),p=new b($);if(r._childs&&!s)for(let u=0;u<r._childs.length;++u){const h=r._childs[u];f(h?._kind)&&h._kind.indexOf(B("TLeaf"))===0&&l<2&&(l++>0&&(a+=":"),a+=h._name)}return O(p),p.configureOnline(t,o,e,c,a),p.showPlayer(),p}function _e(i,t){return k(i,t,!0)}function xe(i,t){return k(i,t,!1,!0)}async function ye(i,t,e){let s=t,r=e;if(t._typename===I?(r={expr:`.${t.func}()`,branch:t.branch},e&&e.indexOf("dump")===0?r.expr+=">>"+e:e&&(r.expr+=e),s=t.branch.$tree):t.$branch?(r={expr:`.${t.fName}${e||""}`,branch:t.$branch},(r.branch.fType===N||r.branch.fType===S)&&(r.expr=e,r.direct_branch=!0),s=t.$branch.$tree):t.$tree?(!e&&t.fStreamerType&&t.fStreamerType!==V&&t.fStreamerType>=E&&t.fStreamerType<=F&&(e="dump"),r={expr:e,branch:t},s=t.$tree):(r||(r="player"),f(r)&&(r={expr:r})),!s)throw Error("No TTree object available for TTree::Draw");if(f(r.expr)){const n=r.expr.indexOf("player");n===0?(r.player=!0,r.expr=r.expr.slice(6),r.expr[0]===":"&&(r.expr=r.expr.slice(1))):n>=0&&n===r.expr.length-6&&(r.player=!0,r.expr=r.expr.slice(0,n),n>0&&r.expr[n-1]===";"&&(r.expr=r.expr.slice(0,n-1)))}let a;r.player?(a=new g(i,t,e),O(a),a.configureTree(s),a.showPlayer(r),r.drawid=a.drawid):r.drawid=i,r.progress=P.bind(r);let l;if(r.expr==="testio")r.testio=!0,r.showProgress=n=>T(n,-1,()=>{r._break=1}),l=L(s,r);else if(r.expr||r.branch)l=v(s,r);else return a;return l.then(n=>r.progress(n,!0))}export{xe as drawLeafPlayer,ye as drawTree,k as drawTreePlayer,_e as drawTreePlayerKey,P as treeDrawProgress};
